import{u as e,a,b as t,f as l,_ as o,p as n,c as s,C as r}from"./useUploadFiles-Cz8mgLOH.js";import{m as i,q as u,s as d,d as c,t as p,v,x as m,c as g,y as h,I as f,z as b,A as y,C as k,D as x,E as w,F as _,G as C,H as A,P as S,J as I,K as B,a as O,b as j,L,f as F,e as $,M as z,w as q,S as E,N as H,O as T,Q as M,R as P,o as N,T as D,U,V as Q,l as V,W as R,X as G,B as K,g as Y,j as Z,Y as W,r as X,Z as J,$ as ee,p as ae,i as te,a0 as le,u as oe,a1 as ne,a2 as se,k as re,a3 as ie,n as ue,a4 as de}from"./index-Dnd1wrVz.js";import{g as ce,u as pe}from"./index-BGs17W_C.js";import{F as ve,_ as me}from"./index-Wcu94PXT.js";import{u as ge,a as he,b as fe,c as be}from"./urlConfig-BRkfAQUm.js";import{u as ye}from"./useChatSetting-BAUL9MYY.js";import{u as ke}from"./useQuickStart-DysNHfgZ.js";import{r as xe}from"./utils-Dy9G1Irh.js";import{u as we}from"./useBots-CpcdgWbc.js";import{u as _e}from"./useBotsChat-CAp_Tb2G.js";import{r as Ce}from"./router-DqwQACVR.js";import{_ as Ae}from"./knowledge-zhu8jsrY.js";import{u as Se}from"./useHeader-BG3iu7vQ.js";import{_ as Ie}from"./ChatSourceDialog.vue_vue_type_script_setup_true_lang-rhUKbI-1.js";import{_ as Be}from"./index-DxXpsklO.js";import{F as Oe}from"./FolderOutlined-rNcZH25l.js";import{U as je,P as Le}from"./UserOutlined-sw_XmNpd.js";import{S as Fe,a as $e}from"./injectionKey-BS_bSTfS.js";import{R as ze}from"./RightOutlined-BOg6omYT.js";import{L as qe}from"./LeftOutlined-CbcobKim.js";import"./index-CXl91b5n.js";import"./index-BOQF8sB2.js";import"./responsiveObserve-DBZcF5T1.js";import"./collapseMotion-SidVLewu.js";import"./class-FJ4HjPo2.js";import"./index-lv1W1ebf.js";import"./useChatSource-BAwYmxq4.js";const Ee=e=>{const{componentCls:a,colorBgContainer:t,colorBgBody:l,colorText:o}=e;return{[`${a}-sider-light`]:{background:t,[`${a}-sider-trigger`]:{color:o,background:t},[`${a}-sider-zero-width-trigger`]:{color:o,background:t,border:`1px solid ${l}`,borderInlineStart:0}}}},He=e=>{const{antCls:a,componentCls:t,colorText:l,colorTextLightSolid:o,colorBgHeader:n,colorBgBody:s,colorBgTrigger:r,layoutHeaderHeight:i,layoutHeaderPaddingInline:u,layoutHeaderColor:c,layoutFooterPadding:p,layoutTriggerHeight:v,layoutZeroTriggerSize:m,motionDurationMid:g,motionDurationSlow:h,fontSize:f,borderRadius:b}=e;return{[t]:d(d({display:"flex",flex:"auto",flexDirection:"column",color:l,minHeight:0,background:s,"&, *":{boxSizing:"border-box"},[`&${t}-has-sider`]:{flexDirection:"row",[`> ${t}, > ${t}-content`]:{width:0}},[`${t}-header, &${t}-footer`]:{flex:"0 0 auto"},[`${t}-header`]:{height:i,paddingInline:u,color:c,lineHeight:`${i}px`,background:n,[`${a}-menu`]:{lineHeight:"inherit"}},[`${t}-footer`]:{padding:p,color:l,fontSize:f,background:s},[`${t}-content`]:{flex:"auto",minHeight:0},[`${t}-sider`]:{position:"relative",minWidth:0,background:n,transition:`all ${g}, background 0s`,"&-children":{height:"100%",marginTop:-.1,paddingTop:.1,[`${a}-menu${a}-menu-inline-collapsed`]:{width:"auto"}},"&-has-trigger":{paddingBottom:v},"&-right":{order:1},"&-trigger":{position:"fixed",bottom:0,zIndex:1,height:v,color:o,lineHeight:`${v}px`,textAlign:"center",background:r,cursor:"pointer",transition:`all ${g}`},"&-zero-width":{"> *":{overflow:"hidden"},"&-trigger":{position:"absolute",top:i,insetInlineEnd:-m,zIndex:1,width:m,height:m,color:o,fontSize:e.fontSizeXL,display:"flex",alignItems:"center",justifyContent:"center",background:n,borderStartStartRadius:0,borderStartEndRadius:b,borderEndEndRadius:b,borderEndStartRadius:0,cursor:"pointer",transition:`background ${h} ease`,"&::after":{position:"absolute",inset:0,background:"transparent",transition:`all ${h}`,content:'""'},"&:hover::after":{background:"rgba(255, 255, 255, 0.2)"},"&-right":{insetInlineStart:-m,borderStartStartRadius:b,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:b}}}}},Ee(e)),{"&-rtl":{direction:"rtl"}})}},Te=i("Layout",(e=>{const{colorText:a,controlHeightSM:t,controlHeight:l,controlHeightLG:o,marginXXS:n}=e,s=1.25*o,r=u(e,{layoutHeaderHeight:2*l,layoutHeaderPaddingInline:s,layoutHeaderColor:a,layoutFooterPadding:`${t}px ${s}px`,layoutTriggerHeight:o+2*n,layoutZeroTriggerSize:o});return[He(r)]}),(e=>{const{colorBgLayout:a}=e;return{colorBgHeader:"#001529",colorBgBody:a,colorBgTrigger:"#002140"}})),Me=()=>({prefixCls:String,hasSider:{type:Boolean,default:void 0},tagName:String});function Pe(e){let{suffixCls:a,tagName:t,name:l}=e;return e=>c({compatConfig:{MODE:3},name:l,props:Me(),setup(l,o){let{slots:n}=o;const{prefixCls:s}=p(a,l);return()=>{const a=d(d({},l),{prefixCls:s.value,tagName:t});return g(e,a,n)}}})}const Ne=c({compatConfig:{MODE:3},props:Me(),setup(e,a){let{slots:t}=a;return()=>g(e.tagName,{class:e.prefixCls},t)}}),De=c({compatConfig:{MODE:3},inheritAttrs:!1,props:Me(),setup(e,a){let{slots:t,attrs:l}=a;const{prefixCls:o,direction:n}=p("",e),[s,r]=Te(o),i=v([]);h(Fe,{addSider:e=>{i.value=[...i.value,e]},removeSider:e=>{i.value=i.value.filter((a=>a!==e))}});const u=m((()=>{const{prefixCls:a,hasSider:t}=e;return{[r.value]:!0,[`${a}`]:!0,[`${a}-has-sider`]:"boolean"==typeof t?t:i.value.length>0,[`${a}-rtl`]:"rtl"===n.value}}));return()=>{const{tagName:a}=e;return s(g(a,d(d({},l),{class:[u.value,l.class]}),t))}}}),Ue=Pe({suffixCls:"layout",tagName:"section",name:"ALayout"})(De),Qe=Pe({suffixCls:"layout-header",tagName:"header",name:"ALayoutHeader"})(Ne),Ve=Pe({suffixCls:"layout-footer",tagName:"footer",name:"ALayoutFooter"})(Ne),Re=Pe({suffixCls:"layout-content",tagName:"main",name:"ALayoutContent"})(Ne);var Ge={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"bars",theme:"outlined"};function Ke(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){Ye(e,a,t[a])}))}return e}function Ye(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var Ze=function(e,a){var t=Ke({},e,a.attrs);return g(f,Ke({},t,{icon:Ge}),null)};Ze.displayName="BarsOutlined",Ze.inheritAttrs=!1;const We={xs:"479.98px",sm:"575.98px",md:"767.98px",lg:"991.98px",xl:"1199.98px",xxl:"1599.98px",xxxl:"1999.98px"},Xe=(()=>{let e=0;return function(){return e+=1,`${arguments.length>0&&void 0!==arguments[0]?arguments[0]:""}${e}`}})(),Je=c({compatConfig:{MODE:3},name:"ALayoutSider",inheritAttrs:!1,props:b({prefixCls:String,collapsible:{type:Boolean,default:void 0},collapsed:{type:Boolean,default:void 0},defaultCollapsed:{type:Boolean,default:void 0},reverseArrow:{type:Boolean,default:void 0},zeroWidthTriggerStyle:{type:Object,default:void 0},trigger:S.any,width:S.oneOfType([S.number,S.string]),collapsedWidth:S.oneOfType([S.number,S.string]),breakpoint:S.oneOf(I("xs","sm","md","lg","xl","xxl","xxxl")),theme:S.oneOf(I("light","dark")).def("dark"),onBreakpoint:Function,onCollapse:Function},{collapsible:!1,defaultCollapsed:!1,reverseArrow:!1,width:200,collapsedWidth:80}),emits:["breakpoint","update:collapsed","collapse"],setup(e,a){let{emit:t,attrs:l,slots:o}=a;const{prefixCls:n}=p("layout-sider",e),s=x(Fe,void 0),r=y(!!(void 0!==e.collapsed?e.collapsed:e.defaultCollapsed)),i=y(!1);k((()=>e.collapsed),(()=>{r.value=!!e.collapsed})),h($e,r);const u=(a,l)=>{void 0===e.collapsed&&(r.value=a),t("update:collapsed",a),t("collapse",a,l)},d=y((e=>{i.value=e.matches,t("breakpoint",e.matches),r.value!==e.matches&&u(e.matches,"responsive")}));let c;function v(e){return d.value(e)}const m=Xe("ant-sider-");s&&s.addSider(m),w((()=>{k((()=>e.breakpoint),(()=>{try{null==c||c.removeEventListener("change",v)}catch(a){null==c||c.removeListener(v)}if("undefined"!=typeof window){const{matchMedia:t}=window;if(t&&e.breakpoint&&e.breakpoint in We){c=t(`(max-width: ${We[e.breakpoint]})`);try{c.addEventListener("change",v)}catch(a){c.addListener(v)}v(c)}}}),{immediate:!0})})),_((()=>{try{null==c||c.removeEventListener("change",v)}catch(e){null==c||c.removeListener(v)}s&&s.removeSider(m)}));const f=()=>{u(!r.value,"clickTrigger")};return()=>{var a,t;const s=n.value,{collapsedWidth:u,width:d,reverseArrow:c,zeroWidthTriggerStyle:p,trigger:v=(null===(a=o.trigger)||void 0===a?void 0:a.call(o)),collapsible:m,theme:h}=e,b=r.value?u:d,y=(k=b,!isNaN(parseFloat(k))&&isFinite(k)?`${b}px`:String(b));var k;const x=0===parseFloat(String(u||0))?g("span",{onClick:f,class:C(`${s}-zero-width-trigger`,`${s}-zero-width-trigger-${c?"right":"left"}`),style:p},[v||g(Ze,null,null)]):null,w={expanded:g(c?ze:qe,null,null),collapsed:g(c?qe:ze,null,null)},_=r.value?"collapsed":"expanded",S=null!==v?x||g("div",{class:`${s}-trigger`,onClick:f,style:{width:y}},[v||w[_]]):null,I=[l.style,{flex:`0 0 ${y}`,maxWidth:y,minWidth:y,width:y}],B=C(s,`${s}-${h}`,{[`${s}-collapsed`]:!!r.value,[`${s}-has-trigger`]:m&&null!==v&&!x,[`${s}-below`]:!!i.value,[`${s}-zero-width`]:0===parseFloat(y)},l.class);return g("aside",A(A({},l),{},{class:B,style:I}),[g("div",{class:`${s}-children`},[null===(t=o.default)||void 0===t?void 0:t.call(o)]),m||i.value&&x?S:null])}}}),ea=Je,aa=Re,ta=d(Ue,{Header:Qe,Footer:Ve,Content:Re,Sider:Je,install:e=>(e.component(Ue.name,Ue),e.component(Qe.name,Qe),e.component(Ve.name,Ve),e.component(Je.name,Je),e.component(Re.name,Re),e)});var la={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 732h-70.3c-4.8 0-9.3 2.1-12.3 5.8-7 8.5-14.5 16.7-22.4 24.5a353.84 353.84 0 01-112.7 75.9A352.8 352.8 0 01512.4 866c-47.9 0-94.3-9.4-137.9-27.8a353.84 353.84 0 01-112.7-75.9 353.28 353.28 0 01-76-112.5C167.3 606.2 158 559.9 158 512s9.4-94.2 27.8-137.8c17.8-42.1 43.4-80 76-112.5s70.5-58.1 112.7-75.9c43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 7.9 7.9 15.3 16.1 22.4 24.5 3 3.7 7.6 5.8 12.3 5.8H868c6.3 0 10.2-7 6.7-12.3C798 160.5 663.8 81.6 511.3 82 271.7 82.6 79.6 277.1 82 516.4 84.4 751.9 276.2 942 512.4 942c152.1 0 285.7-78.8 362.3-197.7 3.4-5.3-.4-12.3-6.7-12.3zm88.9-226.3L815 393.7c-5.3-4.2-13-.4-13 6.3v76H488c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h314v76c0 6.7 7.8 10.5 13 6.3l141.9-112a8 8 0 000-12.6z"}}]},name:"logout",theme:"outlined"};function oa(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){na(e,a,t[a])}))}return e}function na(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var sa=function(e,a){var t=oa({},e,a.attrs);return g(f,oa({},t,{icon:la}),null)};sa.displayName="LogoutOutlined",sa.inheritAttrs=!1;var ra={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"};function ia(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){ua(e,a,t[a])}))}return e}function ua(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var da=function(e,a){var t=ia({},e,a.attrs);return g(f,ia({},t,{icon:ra}),null)};da.displayName="ThunderboltOutlined",da.inheritAttrs=!1;const ca={class:"mt-50px"},pa={class:"basic-box"},va={key:0,class:"mt3"},ma={key:1,class:"mt3"},ga={key:0,class:"loading-line-box"},ha=V(c({__name:"UploadInput",props:{kbId:{type:String,required:!0}},setup(a){const{urlList:t}=B(e()),l=ce().common,o={span:10},n={span:10},s=v(null),r=v([]),i=v(""),u=v("normal"),d=()=>{if(!i.value)return void(u.value="error");const e={status:"default",text:i.value,percent:0};t.value.push(e),i.value=""},c=(e,a)=>{t.value[e].status=a};return _((()=>{r.value.forEach((e=>{clearInterval(e)}))})),(e,a)=>{const r=E,p=F,v=me,m=ve;return N(),O("div",ca,[j("div",pa,[g(p,{value:$(i),"onUpdate:value":a[0]||(a[0]=e=>z(i)?i.value=e:null),status:$(u),placeholder:$(l).urlPlaceholder,onChange:a[1]||(a[1]=e=>{i.value&&(u.value="normal")})},{suffix:q((()=>[g(r,{name:"add",class:"mt3",onClick:d})])),_:1},8,["value","status","placeholder"]),L(j("span",{class:"red-text"},T($(l).errTip),513),[[H,"error"===$(u)]])]),g(m,{"label-col":o,"wrapper-col":n},{default:q((()=>[(N(!0),O(M,null,P($(t),((e,a)=>(N(),D(v,{key:a,class:"relative",onMouseenter:e=>c(a,"hover"),onMouseleave:e=>c(a,"default")},{default:q((()=>[g(p,{value:e.text,"onUpdate:value":a=>e.text=a,placeholder:$(l).urlPlaceholder},{suffix:q((()=>["hover"===e.status?(N(),O("span",va,[g(r,{name:"card-delete",onClick:e=>(e=>{t.value.splice(e,1)})(a)},null,8,["onClick"])])):(N(),O("span",ma))])),_:2},1032,["value","onUpdate:value","placeholder"]),"parsing"===e.status?(N(),O("span",ga,[j("span",{ref_for:!0,ref_key:"percentRef",ref:s,class:"loading-line",style:Q({width:e.percent+"%"})},null,4)])):U("",!0)])),_:2},1032,["onMouseenter","onMouseleave"])))),128))])),_:1})])}}}),[["__scopeId","data-v-de2898e6"]]),fa={class:"line-url"},ba=V(c({__name:"UrlUploadDialog",setup(l){const o=ce().common,{setKnowledgeName:n}=e(),{urlModalVisible:s,modalTitle:r,urlList:i}=B(e()),{currentId:u,currentKbName:d}=B(a()),{getDetails:c}=t(),{chatSettingFormActive:p}=B(ye()),h=v(!1),f=v(),b=v([]),y=m((()=>i.value.length&&i.value.every((e=>e.text.length))));k((()=>s.value),(()=>{n(d.value),s.value||(b.value=[])}));const x=async()=>{h.value=!0;await Promise.all(i.value.map(w));h.value=!1,s.value=!1,c()},w=async e=>{let a=await ge.uploadUrl({chunk_size:p.value.chunkSize,kb_id:u.value,url:e.text,mode:"strong"});return null==a?void 0:a.data};return _((()=>{f.value&&clearTimeout(f.value)})),(e,a)=>{const t=K,l=G;return N(),D(R,{to:"body"},[g(l,{open:$(s),"onUpdate:open":a[0]||(a[0]=e=>z(s)?s.value=e:null),title:$(r),centered:"",width:"480px","wrap-class-name":"upload-file-modal",onOk:x},{footer:q((()=>[g(t,{key:"submit",type:"primary",class:"upload-btn",disabled:!$(y),loading:$(h),onClick:x},{default:q((()=>[Y(T($(o).confirm),1)])),_:1},8,["disabled","loading"])])),default:q((()=>[j("div",fa,[g(ha,{"kb-id":$(u)},null,8,["kb-id"])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-bbaf2796"]]),ya={class:"private"},ka={class:"private-title"},xa=V(c({__name:"DeleteModal",setup(e){const t=ce().common,{showDeleteModal:l,currentId:o,selectList:n}=B(a()),{setShowDeleteModal:s,getList:r}=a(),{clearChatList:i}=ke(),{deleteChatId:u}=B(ke()),d=v(!1),c=async()=>{d.value=!0;try{if(200===(await Promise.race([await ge.deleteKB({kb_ids:[o.value]}),await ge.deleteKB({kb_ids:[o.value+"_FAQ"]})])).code){const e=n.value.findIndex((e=>e===o.value));-1!=e&&n.value.splice(e,1),s(!1),d.value=!1,Z.success("删除成功"),i(u.value),u.value=null,await r()}else d.value=!1,Z.error("删除失败")}catch(e){d.value=!1,Z.error(e.msg||"删除失败")}};return(e,a)=>{const o=E,n=G;return N(),D(R,{to:"body"},[j("div",ya,[g(n,{open:$(l),"onUpdate:open":a[0]||(a[0]=e=>z(l)?l.value=e:null),"confirm-loading":$(d),centered:"",width:"480px","wrap-class-name":"private-modal","ok-text":$(t).confirm,"cancel-text":$(t).cancel,onOk:c},{title:q((()=>[j("div",ka,[g(o,{class:"info",name:"info"}),Y(" "+T($(t).deleteDec),1)])])),_:1},8,["open","confirm-loading","ok-text","cancel-text"])])])}}}),[["__scopeId","data-v-e087b486"]]),wa={class:""};const _a=V({},[["render",function(e,a){return N(),O("div",wa,[W(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-aafb4bc0"]]),Ca={class:"edit-qa-set-comp"},Aa={class:"tabs"},Sa=["onClick"],Ia={class:"footer"},Ba={key:1,class:"upload-excel"},Oa={class:"demo-download"},ja={href:"https://download.ydstatic.com/ead/QAnything_QA_模板.xlsx",download:"QAnything_QA_模板.xlsx"},La={class:"box"},Fa={key:0,class:"before-upload-box"},$a=["accept"],za={class:"before-upload"},qa={class:"upload-text-box"},Ea={key:0},Ha={class:"upload-text"},Ta={class:"blue"},Ma={key:1},Pa={class:"upload-text"},Na={class:"blue"},Da={class:"list"},Ua={class:"name"},Qa={class:"status-box"},Va={key:1,class:"loading",src:o,alt:"loading"},Ra={class:"status"},Ga={class:"overly"},Ka=["accept"],Ya={class:"overly-content"},Za=(e=>(ae("data-v-314cbec1"),e=e(),te(),e))((()=>j("span",null,"重新上传",-1))),Wa=["src"],Xa=V(c({__name:"EditQaSetDialog",setup(e){const{setEditModalVisible:o,setEditQaSet:n,getFaqList:s}=t(),{editModalVisible:r,editQaSet:i,faqType:u}=B(t()),{currentId:d}=B(a()),{chatSettingFormActive:c}=B(ye()),p=ce().home,m=ce().common,{language:h}=B(pe()),f=v(!1),b=X({question:"",answer:"",imgs:[]}),y=v(0),x=v(!1),w=v(""),_=v(""),C=[{name:p.enterQa,value:0},{name:p.batchUpload,value:1}],A=v(!1),S=v([]);k((()=>r.value),(()=>{var e,a,t;r.value?(y.value=0,i.value&&(b.question=null==(e=i.value)?void 0:e.question,b.answer=null==(a=i.value)?void 0:a.answer,b.imgs=null==(t=i.value)?void 0:t.picUrlList)):(n(null),b.question="",b.answer="",b.imgs=[],A.value=!1,S.value=[])}),{immediate:!0});const I=async e=>{f.value=!0,"edit"===u.value&&await(async()=>{var e;try{await xe(await ge.deleteFile({kb_id:`${d.value}_FAQ`,file_ids:[null==(e=i.value)?void 0:e.faqId]}))}catch(a){Z.error(a.msg||"删除失败")}})();try{const a=[{question:e.question,answer:e.answer,nos_key:null}];await xe(await ge.uploadFaqs({kb_id:`${d.value}_FAQ`,faqs:a,chunk_size:c.value.chunkSize.toString()}));Z.success("上传成功")}catch(a){Z.error(a.msg||"获取Bot信息失败")}s(),f.value=!1,o(!1)},L=e=>{S.value=[];const a=e.target.files;Array.from(a).forEach((async(e,a)=>{try{await(async(e,a)=>new Promise(((t,l)=>{"xlsx"===e.name.split(".").pop().toLowerCase()?(S.value.push({file_name:e.name,file:e,status:"loading",errorText:m.uploading,file_id:"",order:S.value.length}),t(a)):l(e.name)})))(e,a)}catch(t){Z.error(`${t}的文件格式不符`)}})),setTimeout((()=>{S.value.length&&H()}))},H=async()=>{var e;const a=[];A.value=!0,S.value.forEach((e=>{"loading"===e.status&&a.push(e)}));const t=new FormData;for(let l=0;l<a.length;l++)t.append("files",null==(e=a[l])?void 0:e.file);t.append("user_id",he),t.append("user_info",fe),t.append("kb_id",`${d.value}_FAQ`),fetch(be+"/local_doc_qa/upload_faqs",{method:"POST",body:t}).then((e=>{if(e.ok)return e.json();throw new Error("上传失败")})).then((e=>{200===e.code?(a.forEach(((a,t)=>{let l=e.data[t].status;l="green"==l||"gray"==l?"success":"error",S.value[a.order].status=l,S.value[a.order].errorText=m.upSucceeded})),o(!1),Z.success("上传成功")):(Z.error(e.msg||"出错了"),a.forEach((a=>{S.value[a.order].status="error",S.value[a.order].errorText=(null==e?void 0:e.msg)||m.upFailed})))})).catch((e=>{a.forEach((e=>{S.value[e.order].status=l.error,S.value[e.order].errorText=(null==e?void 0:e.msg)||m.upFailed})),Z.error(JSON.stringify(e.message)||"出错了")})),s()},U=()=>{x.value=!1,_.value=""};return(e,a)=>{const t=F,l=me,n=J,s=K,i=ve,u=E,d=_a,c=G;return N(),D(R,{to:"body"},[g(c,{open:$(r),"onUpdate:open":a[5]||(a[5]=e=>z(r)?r.value=e:null),title:$(p).inputQa,centered:"",destroyOnClose:!0,width:"480px","wrap-class-name":"edit-qa-set-modal",footer:null},{default:q((()=>[j("div",Ca,[j("div",Aa,[(N(),O(M,null,P(C,(e=>j("div",{class:ee(["tab-item",$(y)===e.value?"tab-item-active":""]),key:e.name,onClick:a=>{return t=e.value,void(y.value=t);var t}},T(e.name),11,Sa))),64))]),0===$(y)?(N(),D(i,{key:0,model:$(b),name:"edit_qa_set",class:"edit-qa-set-form",onFinish:I},{default:q((()=>[g(l,{name:"question",rules:[{required:!0,message:$(p).plsInputQ}]},{default:q((()=>[g(t,{value:$(b).question,"onUpdate:value":a[0]||(a[0]=e=>$(b).question=e),placeholder:$(p).setQPlaceholder,"show-count":"",maxlength:100,"allow-clear":""},null,8,["value","placeholder"])])),_:1},8,["rules"]),g(l,{name:"answer",rules:[{required:!0,message:$(p).plsInputA}]},{default:q((()=>[g(n,{value:$(b).answer,"onUpdate:value":a[1]||(a[1]=e=>$(b).answer=e),placeholder:$(p).setAPlaceholder,"show-count":"",maxlength:1e3,"auto-size":{minRows:5,maxRows:5}},null,8,["value","placeholder"])])),_:1},8,["rules"]),g(l,null,{default:q((()=>[j("div",Ia,[g(s,{class:"cancel-btn",onClick:a[2]||(a[2]=e=>$(o)(!1))},{default:q((()=>[Y(T($(m).cancel),1)])),_:1}),g(s,{loading:$(f),type:"primary","html-type":"submit",class:"login-form-btn"},{default:q((()=>[Y(T($(m).confirm2),1)])),_:1},8,["loading"])])])),_:1})])),_:1},8,["model"])):(N(),O("div",Ba,[j("div",Oa,[j("a",ja,T($(p).downTemp),1),j("span",null,T($(p).uploadXlsxDesc),1)]),j("div",La,[$(A)?(N(),O("div",{key:1,class:ee(["upload-box","upload-list",`upload-${$(S)[0].status}`])},[g(d,null,{default:q((()=>[j("ul",Da,[(N(!0),O(M,null,P($(S),((e,a)=>(N(),O("li",{key:a},[j("span",Ua,T(e.file_name),1),j("div",Qa,["loading"!=e.status?(N(),D(u,{key:0,name:e.status},null,8,["name"])):(N(),O("img",Va)),j("span",Ra,T(e.errorText),1)])])))),128))])])),_:1}),j("div",Ga,[j("input",{class:"hide input",type:"file",accept:".xlsx",onChange:L,onClick:a[4]||(a[4]=e=>e.target.value="")},null,40,Ka),j("div",Ya,[g(u,{name:"upload-white"}),Za])])],2)):(N(),O("div",Fa,[j("input",{class:"hide input",type:"file",accept:".xlsx",onChange:L,onClick:a[3]||(a[3]=e=>e.target.value="")},null,40,$a),j("div",za,[j("div",qa,[g(u,{name:"upload"}),"zh"===$(h)?(N(),O("p",Ea,[j("span",Ha,[Y(T($(m).dragUrl),1),j("span",Ta,T($(m).click),1)])])):(N(),O("p",Ma,[j("span",Pa,[j("span",Na,T($(m).click)+" ",1),Y(T($(m).dragUrl),1)])]))])])]))])])),g(c,{open:$(x),title:$(_),footer:null,onCancel:U,width:"auto",centered:""},{default:q((()=>[j("img",{alt:"example",style:{"max-width":"100%","max-height":"80vh",height:"auto",width:"auto",margin:"0 auto"},src:$(w)},null,8,Wa)])),_:1},8,["open","title"])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-314cbec1"]]),Ja={class:"new-bots-comp"},et={class:"item-title"},at=(e=>(ae("data-v-3a012589"),e=e(),te(),e))((()=>j("span",null,"*",-1))),tt={class:"item-title"},lt={class:"footer"},ot=V(c({__name:"NewBotsDialog",setup(e){const{changePage:a}=Ce(),{newBotsVisible:t}=B(we()),{setNewBotsVisible:l,setCurBot:o,setTabIndex:n}=we(),{setQaList:s}=_e(),r=ce().bots,i=ce().common,u=v(!1),d=v(null),c=X({name:"",introduction:""}),p=async e=>{try{const t=await xe(await ge.createBot({bot_name:e.name,description:e.introduction}));await(async e=>{try{const a=await xe(await ge.queryBotInfo({bot_id:e}));o(a[0])}catch(a){Z.error(a.msg||"获取Bot信息失败")}})(t.bot_id),Z.success(r.creationSuccessful),n(0),s([]),c.name="",c.introduction="",d.value=null,a(`/bots/${t.bot_id}/edit`)}catch(t){Z.error(t.msg||"创建失败")}l(!1)},m=e=>{};return(e,a)=>{const o=F,n=me,s=J,d=K,v=ve,h=G;return N(),D(R,{to:"body"},[g(h,{open:$(t),"onUpdate:open":a[3]||(a[3]=e=>z(t)?t.value=e:null),title:$(r).createBots,centered:"",destroyOnClose:!0,width:"480px","wrap-class-name":"new-bot-modal",footer:null},{default:q((()=>[j("div",Ja,[g(v,{model:$(c),name:"new_bots",class:"new-bots-form",onFinish:p,onFinishFailed:m},{default:q((()=>[g(n,{name:"name",rules:[{required:!0,message:$(r).nameCantEmpty}]},{default:q((()=>[j("div",et,[Y(T($(r).botName)+" ",1),at]),g(o,{class:"name-input",value:$(c).name,"onUpdate:value":a[0]||(a[0]=e=>$(c).name=e),placeholder:$(r).inputName,"show-count":"",maxlength:20,"allow-clear":""},null,8,["value","placeholder"])])),_:1},8,["rules"]),g(n,{name:"introduction"},{default:q((()=>[j("div",tt,T($(r).botFunctionIntro),1),g(s,{class:"intro-input",value:$(c).introduction,"onUpdate:value":a[1]||(a[1]=e=>$(c).introduction=e),placeholder:$(r).introBotFunction,"show-count":"",maxlength:200,"auto-size":{minRows:3,maxRows:3}},null,8,["value","placeholder"])])),_:1}),g(n,null,{default:q((()=>[j("div",lt,[g(d,{class:"cancel-btn",onClick:a[2]||(a[2]=e=>$(l)(!1))},{default:q((()=>[Y(T($(i).cancel),1)])),_:1}),g(d,{loading:$(u),type:"primary","html-type":"submit",class:"login-form-btn"},{default:q((()=>[Y(T($(i).confirm2),1)])),_:1},8,["loading"])])])),_:1})])),_:1},8,["model"])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-3a012589"]]),nt=e=>(ae("data-v-44d61a98"),e=e(),te(),e),st={class:"select-kenoledge-comp"},rt={class:"header"},it=nt((()=>j("img",{class:"search-icon",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAK9SURBVFiFxZc9SBxRFIW/uzjVSgi4gYCNWCx2JpYigoGAKZPOMhbzhC2SFBaChYJgYZFYDONMYWtn0ikEIshiabKdGDBtIGsT1GaGuSl8s4yyu+7PaE4zP28455u38+67C/9Z0slDQRBMAG+AKWAMKNmhOnACVIFdY8xxrgBBEMyIyJqqTnZkJnKkqsvGmIO+ADzPG3QcZ0NVF+ytuqruAPuqWhsaGvoNcH5+/lRExoFZEZnDzoyIbEVRtFipVC66Btje3n4SRdFXYBy4BNbjON68y8zzvMGBgYF3wBJQBGqO47ycn5//0zGANakC46p6VigUXrmue3rXW2QVhmE5SZI9ERkFanEcT7WDL2QvHMfZSMNVdbrbcADXdU9VdVpVz4Bx69lSjRkIgmAG+AZcishEL+FZhWFYVtVjrn+OF60+zMYMiMiaPV3vNxyuZwJYv+XdHCAIggm71OpxHG/2G57KetVVddLWkuYAXBcZVHWnk6XTqSqVyoVdvo2MVgBT9rifV3hGqedUs8EUYAxAVWt5p2c8x9oBlADSCpenMp6lZuOFZjcfUilAHa5re94BGc96O4ATALux5KqM50k7gKo9zuYNkPGsNhtMAXYBRGTO87zBvJI9zxu023QjoymAMeZYRI6Akt1Sc5H1KonIUatuqbEKVHXZni6FYVjuN9x6LN3ybg1gjDkQkS2gmCTJnu/7w72G+74/nCTJHlAUka12LdqNOhBF0SJQE5FRETnsZSbCMCyLyGHakFjPlrrPlgxVLS8sLPzsCiA166cpBf4Cj4AvxpjXXQOk6rUtT5LkV6FQOABGgFVjzEpPABmQrv+YhGH4TFW/28sPxphPPQP0qiAI3gMfAUTkueu6P24/c6+7oX3rVQBV/ez7/siDAliIFeALMGK/ixsauG8AgKurq7fFYvHxQ2R1rX+LYk0uyg453wAAAABJRU5ErkJggg==",alt:"search-icon"},null,-1))),ut={class:"content"},dt=nt((()=>j("img",{src:Ae,alt:"knowledge"},null,-1))),ct={class:"detail-info"},pt={class:"kb-name"},vt=["onClick"],mt={class:"bottom-text"},gt=V(c({__name:"SelectKnowledgeDialog",setup(e){const{changePage:a}=Ce(),{selectKnowledgeVisible:t,knowledgeList:l,curBot:o}=B(we()),{setCurBot:n}=we(),{setNavIndex:s}=Se(),r=v(""),i=ce().bots,u=ce().common,d=m((()=>new RegExp(r.value,"i"))),c=async e=>{try{const a=await xe(await ge.queryBotInfo({bot_id:e}));n(a[0])}catch(a){Z.error(a.msg||"获取Bot信息失败")}},p=e=>{0===e.state?(async e=>{const a=o.value.kb_ids;a.push(e.kb_id);try{await xe(await ge.updateBot({bot_id:o.value.bot_id,kb_ids:a})),c(o.value.bot_id),l.value=l.value.map((a=>(a.kb_id===e.kb_id&&(a.state=0===a.state?1:0),a)))}catch(t){Z.error(t.msg||"请求失败")}})(e):(async e=>{let a=o.value.kb_ids;a=a.filter((a=>a!=e.kb_id));try{await xe(await ge.updateBot({bot_id:o.value.bot_id,kb_ids:a})),c(o.value.bot_id),l.value=l.value.map((a=>(a.kb_id===e.kb_id&&(a.state=0===a.state?1:0),a))),Z.success(i.removalSucessful)}catch(t){Z.error(t.msg||"请求失败")}})(e)},h=()=>{s(0),a("/home"),t.value=!1};return(e,a)=>{const o=F,n=K,s=G;return N(),D(R,{to:"body"},[g(s,{open:$(t),"onUpdate:open":a[1]||(a[1]=e=>z(t)?t.value=e:null),title:$(i).selectKb,centered:"",destroyOnClose:!0,width:"600px","wrap-class-name":"select-knowledge-modal",footer:null},{default:q((()=>[j("div",st,[j("div",rt,[g(o,{class:"select-input",value:$(r),"onUpdate:value":a[0]||(a[0]=e=>z(r)?r.value=e:null),placeholder:$(i).search},{prefix:q((()=>[it])),_:1},8,["value","placeholder"]),g(n,{class:"btn",type:"primary",onClick:h},{default:q((()=>[Y(T($(i).createKb),1)])),_:1})]),j("div",ut,[(N(!0),O(M,null,P($(l).filter((e=>$(d).test(e.kb_nmame))),(e=>(N(),O("div",{class:"knowledge-item",key:e.kbId},[dt,j("div",ct,[j("div",pt,T(e.kb_name),1)]),j("div",{class:ee(["button",`button-${e.state}`,`button-${$(u).type}-${e.state}`]),onClick:a=>p(e)},null,10,vt)])))),128)),j("div",mt,T($(i).noMore),1)])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-44d61a98"]]),ht={class:"tools-box"},ft={class:"tool-name"},bt={class:"tool-name"},yt={class:"content"},kt={class:"title"},xt={class:"title-text"},wt=V(c({__name:"SiderCardItem",props:{cardData:{}},setup(e){const{setShowDeleteModal:t,setCurrentId:l,setCurrentKbName:o,setDefault:s}=a(),{showDeleteModal:r}=B(a()),i=ce().common,{chatId:u,showLoading:d,deleteChatId:c}=B(ke()),p=e,{cardData:v}=le(p);return(e,a)=>{const p=E,m=Be;return N(),O("div",{class:ee(["card",$(u)===$(v).historyId?"active":"",$(d)?"disabled":""])},[g(m,{"overlay-class-name":"card-hover",placement:"right"},{content:q((()=>[j("div",ht,[j("ul",null,[j("li",{onClick:a[0]||(a[0]=e=>{return a={kb_name:$(v).title,kb_id:$(v).kbId},l(a.kb_id),o(a.kb_name),void s(n.optionlist);var a})},[g(p,{class:"edit",name:"icon-manage"}),j("span",ft,T($(i).manage),1)]),j("li",{onClick:a[1]||(a[1]=e=>{return a={kb_name:$(v).title,kb_id:$(v).kbId},c.value=v.value.historyId,t(!r.value),void l(a.kb_id);var a})},[g(p,{class:"delete",name:"delete"}),j("span",bt,T($(i).delete),1)])])])])),default:q((()=>[j("div",yt,[j("div",kt,[j("p",xt,T($(v).title),1)])])])),_:1})],2)}}}),[["__scopeId","data-v-f9de09da"]]),_t=e=>(ae("data-v-a5ae7c7c"),e=e(),te(),e),Ct={class:"sider"},At=_t((()=>j("div",{class:"logo"},"NovAnything",-1))),St={class:"header-navs"},It=["onClick"],Bt={class:ee(["item-icon"])},Ot={class:"nav-item-name"},jt={key:0,class:"knowledge"},Lt=[_t((()=>j("div",{class:"add-btn"},null,-1)))],Ft={key:1,class:"bots"},$t={key:2,class:"quick-start",style:{display:"none"}},zt={class:"content"},qt={class:"account"},Et=V(c({__name:"Sider",setup(e){const{knowledgeBaseList:t,currentKbName:l}=B(a()),{historyList:o,showLoading:n,chatId:i,QA_List:u,kbId:d}=B(ke()),{getChatById:c,addHistoryList:p,updateHistoryList:v,addChatList:h,addFileToBeSendList:f}=ke(),{uploadFileListQuick:b}=B(s()),{initUploadFileListQuick:y}=s(),{navIndex:k}=B(Se()),{changePage:x}=Ce(),{setNavIndex:w}=Se(),{userInfo:_}=oe(),C=[{name:ce().header.quickStart,value:2,icon:ne(da)},{name:ce().header.knowledge,value:0,icon:ne(Oe)},{name:ce().header.account,value:3,icon:ne(je)}],A=m((()=>{const e=_.role;return"admin"!==e&&"superadmin"!==e?C.filter((e=>3!==e.value)):C}));const S=async(e,a)=>{if(!n.value)if(b.value.length&&(f(i.value,[...b.value]),y()),0===e){const e=await xe(await ge.createKb({kb_name:"未命名对话",is_quick:!0}));d.value=e.kb_id,u.value=[],i.value=p("未命名对话"),v("未命名对话",i.value,d.value),h(i.value,u.value)}else if(1===e){if(i.value===a.historyId)return;i.value=a.historyId,u.value=[],d.value=a.kbId,l.value=a.title,ue((()=>{c(i.value).list.forEach((e=>{var a,t,l,o,n,s,r,i;"user"===e.type?(r=e.question,i=e.fileDataList,u.value.push({question:r,type:"user",fileDataList:i})):"ai"===e.type&&(a=e.question,t=e.itemInfo,l=e.answer,o=e.picList,n=e.qaId,s=e.source,u.value.push({answer:l,itemInfo:t,question:a,type:"ai",qaId:n,copied:!1,like:!1,unlike:!1,source:s||[],showTools:!0,picList:o}))}))}))}},I=()=>{localStorage.removeItem("token"),re.remove("token"),localStorage.clear(),Z.success("退出成功"),x("/login")};return se((()=>{u.value=[],i.value=null,d.value=""})),(e,a)=>(N(),O("div",Ct,[At,j("div",St,[(N(!0),O(M,null,P($(A),(e=>(N(),O("div",{key:e.name,class:ee(["nav-item",$(k)===e.value?"nav-item-active":""]),onClick:a=>{return t=e.value,void(k.value!==t&&(w(t),0===t?x("/home"):1===t?x("/bots"):2===t?x("/quickstart"):3===t&&x("/account")));var t}},[j("div",Bt,[(N(),D(ie(e.icon)))]),j("div",Ot,T(e.name),1)],10,It)))),128))]),0===$(k)?(N(),O("div",jt,Lt)):1===$(k)?(N(),O("div",Ft,[j("div",{class:"bots-tab",onClick:a[0]||(a[0]=e=>$(x)("/bots"))},T($(ce)().bots.myBots),1),g(ot),g(gt),g(r)])):2===$(k)?(N(),O("div",$t,[j("div",zt,[j("div",{class:ee(["card-new",null===$(i)?"active":"",$(n)?"disabled":""]),onClick:a[1]||(a[1]=e=>S(0))},[g($(Le),{class:"plus-icon"}),Y(" "+T($(ce)().home.newConversationQuick),1)],2),(N(!0),O(M,null,P($(o),(e=>(N(),D(wt,{key:e.historyId,"card-data":e,onClick:a=>S(1,e)},null,8,["card-data","onClick"])))),128))])])):U("",!0),j("div",qt,[j("div",{class:"logout-btn",onClick:I},[g($(sa),{class:"logout-icon"}),Y(" "+T("退出登录"))])]),g(Ie),g(xa),g(ba),g(Xa)]))}}),[["__scopeId","data-v-a5ae7c7c"]]),Ht=c({__name:"index",setup:e=>(e,a)=>{const t=ea,l=de("router-view"),o=aa,n=ta;return N(),D(n,null,{default:q((()=>[g(n,null,{default:q((()=>[g(t,{width:"220",style:{background:"red"}},{default:q((()=>[g(Et)])),_:1}),g(n,null,{default:q((()=>[g(o,{class:"main"},{default:q((()=>[g(l)])),_:1})])),_:1})])),_:1})])),_:1})}});export{Ht as default};
