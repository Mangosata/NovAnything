import{u as e,a,C as t,b as s,p as l}from"./useUploadFiles-Cz8mgLOH.js";import{g as o,u as n}from"./index-BGs17W_C.js";import{c as i,I as r,d as c,a as u,b as d,e as v,O as p,o as m,l as h,v as g,p as f,i as b,j as y,a5 as k,K as _,$ as w,g as C,S as I,Q as x,R as j,U as S,n as A,x as D,E as L,F as O,C as q,w as T,B,M as E,k as U,T as F,L as N,N as P,a6 as Q,V as M,f as R,a7 as V,u as H,a8 as K,Y as z}from"./index-Dnd1wrVz.js";import{u as Y,b as $,a as J,c as Z}from"./urlConfig-BRkfAQUm.js";import{u as W,a as X,D as G,f as ee,C as ae,_ as te,T as se,h as le}from"./ChatInfoPanel-FjtXze9J.js";import{_ as oe}from"./scroll-down-Dm5D91pw.js";import{C as ne,r as ie,f as re,t as ce}from"./utils-Dy9G1Irh.js";import{u as ue,_ as de}from"./useChatSource-BAwYmxq4.js";import{C as ve}from"./ChatSettingDialog-B--LcsYW.js";import{u as pe}from"./useChatSetting-BAUL9MYY.js";import{u as me}from"./useBots-CpcdgWbc.js";import{C as he}from"./ChatTextarea-C9n-wMxD.js";import{_ as ge}from"./index-DxXpsklO.js";import{O as fe}from"./OptionList-D8hQbFfP.js";import{R as be}from"./RightOutlined-BOg6omYT.js";import{L as ye}from"./LeftOutlined-CbcobKim.js";import"./index-CXl91b5n.js";import"./index-BOQF8sB2.js";import"./CheckOutlined-BY4Hd7YC.js";import"./index-Wcu94PXT.js";import"./responsiveObserve-DBZcF5T1.js";import"./collapseMotion-SidVLewu.js";import"./class-FJ4HjPo2.js";import"./index-DI3wlhMT.js";import"./slide-emAtT-ep.js";import"./index-b0BYlB-E.js";import"./index-lv1W1ebf.js";import"./index-B_1x0Xrf.js";import"./index-BnSsJVJ9.js";import"./injectionKey-BS_bSTfS.js";import"./FolderOutlined-rNcZH25l.js";import"./TeamOutlined-C1WkXm__.js";import"./UserOutlined-sw_XmNpd.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function _e(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},s=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),s.forEach((function(a){we(e,a,t[a])}))}return e}function we(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var Ce=function(e,a){var t=_e({},e,a.attrs);return i(r,_e({},t,{icon:ke}),null)};Ce.displayName="UploadOutlined",Ce.inheritAttrs=!1;const Ie={class:"upload-box"},xe={class:"title"},je={class:"desc-content"},Se={class:"desc"},Ae={class:"desc"},De=h(c({__name:"UploadDom",props:{acceptList:{require:!0,type:Array,default:()=>[]}},emits:["update"],setup(e,{emit:a}){const t=o().home,s=a,l=()=>{s("update")};return(e,a)=>(m(),u("div",Ie,[d("div",{class:"tips",onClick:l},[i(v(Ce),{class:"upload-icon"}),d("p",xe,p(v(t).startDec),1),d("div",je,[d("p",Se,p(v(t).updesc2),1),d("p",Ae,p(v(t).require1),1)])])]))}}),[["__scopeId","data-v-90d3c6e6"]]),Le={class:"default"},Oe={class:"box"},qe={class:"title"},Te=(e=>(f("data-v-b64d2b02"),e=e(),b(),e))((()=>d("span",null," ",-1))),Be={class:"color"},Ee={class:"desc"},Ue=h(c({__name:"Defaultpage",setup(t){const s=o().home,{setFileList:l}=e(),{setModalVisible:n}=e(),{setCurrentId:r,getList:c,setCurrentKbName:h}=a(),f=[".md",".txt",".pdf",".jpg",".png",".jpeg",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".jsonl",".eml",".csv"],b=g(""),k=async()=>{try{const e=await Y.createKb({kb_name:s.defaultName});200==+e.code&&(b.value=e.data.kb_id,r(e.data.kb_id),h(e.kb_name),n(!0),c())}catch(e){l([]),y.error(e.msg)}};return(e,a)=>(m(),u("div",Le,[d("div",Oe,[d("p",qe,[d("span",null,p(v(s).homeTitle1),1),Te,d("span",Be,p(v(s).homeTitle2),1)]),d("p",Ee,p(v(s).defaultDec),1),i(De,{"accept-list":f,onUpdate:k})])]))}}),[["__scopeId","data-v-b64d2b02"]]),Fe=k("useHomeChat",(()=>{const e=g([]),a=g([]),t=e=>{a.value=e},s=g([]),l=g(null),o=g(1),n=g(1);return{QA_List:e,setQaList:a=>{e.value=a},historyList:a,addHistoryList:e=>{var s;const l=((null==(s=a.value.at(-1))?void 0:s.historyId)||0)+1,o={historyId:l,title:e},n=[...a.value,o];return t(n),l},deleteHistoryList:e=>{const s=a.value.filter((a=>a.historyId!==e));t(s)},updateHistoryList:(e,s,l)=>{const o=a.value.map((a=>(a.historyId===s&&(a.title=e,a.kbIds=l),a)));t(o)},chatList:s,addChatList:(e,a)=>{const t={historyId:e,list:a};s.value.some((a=>a.historyId===e))?s.value.forEach((t=>{t.historyId===e&&(t.list=a)})):s.value.push(t)},getChatById:e=>s.value.filter((a=>a.historyId===e))[0],clearChatList:e=>{s.value=s.value.filter((a=>a.historyId!==e)),a.value=a.value.filter((a=>a.historyId!==e))},chatId:l,setChatId:e=>{l.value=e},pageId:o,setPageId:e=>{o.value=e},qaPageId:n,setQaPageId:e=>{n.value=e}}}),{persist:{storage:localStorage}}),Ne={class:"history-chat"},Pe={class:"history-chat-content"},Qe={class:"list"},Me=(e=>(f("data-v-5ee66f4f"),e=e(),b(),e))((()=>d("div",{class:"line"},null,-1))),Re=["onClick"],Ve=["onClick"],He=h(c({__name:"HistoryChat",props:{observer:{type:Object,required:!0},observeDom:{type:Object,default:null},qaObserver:{type:Object,required:!0},qaObserveDom:{type:Object,default:null},showLoading:{type:Boolean,require:!0}},emits:["scrollBottom","setObserveDom","setQaObserverDom","clearHistory"],setup(e,{emit:t}){const s=e,{chatList:l,chatId:n,QA_List:r,qaPageId:c,pageId:h,historyList:g}=_(Fe()),{deleteHistoryList:f,getChatById:b}=Fe(),{setSelectList:k}=a(),D=t;async function L(e){if(!s.showLoading){n.value=e.historyId,r.value=[],c.value=1,k([...e.kbIds]),D("clearHistory");try{const e=b(n.value);null!==s.qaObserveDom&&(s.qaObserver.unobserve(s.qaObserveDom),D("setQaObserverDom",null)),e.list.forEach((e=>{var a,t,s,l,o,n,i;"user"===e.type?(i=e.question,r.value.push({question:i,type:"user"})):"ai"===e.type&&(a=e.question,t=e.itemInfo,s=e.answer,l=e.picList,o=e.qaId,n=e.source,r.value.push({answer:s,question:a,itemInfo:t,type:"ai",qaId:o,copied:!1,like:!1,unlike:!1,source:n||[],showTools:!0,picList:l}))})),D("scrollBottom"),e.list.length>=50&&await A((()=>{const e=document.getElementsByClassName("chat-li");e.length&&(s.qaObserver.observe(e[0]),D("setQaObserverDom",e[0]))}))}catch(a){y.error(a.msg||"获取问答历史失败")}}}function O(){s.showLoading||(null!==n.value?(n.value=null,r.value=[],c.value=1,h.value=1,D("clearHistory")):y.info("已切换最新对话"))}async function q(e,a){if(!s.showLoading)try{f(e.historyId),e.historyId===n.value&&O(),y.success("删除成功"),l.value.splice(a,1),await A((()=>{!function(){if(null!==s.qaObserveDom){s.qaObserver.unobserve(s.qaObserveDom),D("setQaObserverDom",null);const e=document.getElementsByClassName("chat-li");e.length&&(s.qaObserver.observe(e[0]),D("setQaObserverDom",e[0]))}}()}))}catch(t){y.error(t.msg||"删除失败")}}return(a,t)=>(m(),u("div",Ne,[d("div",Pe,[d("div",Qe,[d("div",{class:w(["new-chat",[e.showLoading?"disabled":"",null===v(n)?"new-active":""]]),onClick:O},[i(I,{name:"new-chat"}),C(" "+p(v(o)().home.newConversation),1)],2),(m(!0),u(x,null,j(v(g),((a,t)=>(m(),u("div",{key:a.historyId,class:w(["chat-item",v(n)===a.historyId?"item-active":"",e.showLoading?"disabled":""])},[Me,d("span",{onClick:e=>L(a)},p(a.title),9,Re),v(n)===a.historyId?(m(),u("img",{key:0,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEgSURBVFiF7ZaxDcJADEVt0lAyQkaAKzIHI0BxkmeKCxiFAaKDDRAdJQvkQpNIEeQu9gVoyK8SXZz/ZPssA8ya9e/KYofW2nVRFMuqqh4pP5fEL0IHRJQj4tl7f7XW7hLMd734tRqgrutV94yIBw1Ea37o3rMsC2YgWALn3N0Yc0PEbQuxNcbcnHMXjXnTNPuyLE9qgBbiooEYMmfmY8wjCqCBSDEXAUggUs0BAFDyUachoxYoyVwNMATRl9YcQFiCvl7LMcUcIDIHfiV1BkIlkM6Jt7gp5p9oQnEGQldNO6ySAMbu+RSIUQDpkEmFGNsHVBMuBSLYhESUe++vUvMR8A0zD0KI9gFtZzPzsbshAPF9ICoiymPbzLfjZ836Dz0BusANDR+zFvgAAAAASUVORK5CYII=",class:"close-icon",alt:"close",onClick:e=>q(a,t)},null,8,Ve)):S("",!0)],2)))),128))])])]))}}),[["__scopeId","data-v-5ee66f4f"]]),Ke=e=>(f("data-v-2977ec87"),e=e(),b(),e),ze={class:"container showSider"},Ye={class:"my-page"},$e={key:0,class:"user"},Je=Ke((()=>d("img",{class:"avatar",src:te,alt:"头像"},null,-1))),Ze={class:"question-text"},We={key:1,class:"ai"},Xe=Ke((()=>d("img",{class:"avatar",src:"/novanything/assets/novLogo-Z4bSx5J8.png",alt:"头像"},null,-1))),Ge={class:"ai-content"},ea={class:"ai-right"},aa={key:0},ta={key:1},sa={class:"source-list"},la={class:"control"},oa={class:"tips"},na=["href"],ia=["onClick"],ra={class:"source-content"},ca={class:"score"},ua={class:"tips"},da={key:1,class:"feed-back"},va=["onClick"],pa={class:"reload-text"},ma={class:"tools"},ha={key:0,class:"stop-btn"},ga={class:"question-box"},fa={class:"question"},ba=h(c({__name:"Chat",setup(e){const s=o().common,l=new se((e=>{e&&(h.value[h.value.length-1].answer+=e||"")})),{selectList:r,knowledgeBaseList:c}=_(a()),{QA_List:h,chatId:f,pageId:b,qaPageId:k,historyList:R}=_(Fe()),{chatSettingFormActive:V}=_(pe()),{copy:H}=W(),{addHistoryList:K,updateHistoryList:z,addChatList:te,clearChatList:fe}=Fe(),{setChatSourceVisible:be,setSourceType:ye,setSourceUrl:ke,setTextContent:_e}=ue(),{setCopyUrlVisible:we,setWebUrl:Ce}=me(),{language:Ie}=_(n()),xe=g(""),je=D((()=>{const e=V.value.context;if(0===e)return[];const a=h.value.filter((e=>"ai"===e.type));return(11===e?a:a.slice(-e)).map((e=>[e.question,e.answer]))})),Se=g(!1),Ae=g([]),De=g(null),Le=g(null);let Oe;const qe=g(null),Te=g(null),Be=()=>{A((()=>{var e;null==(e=Te.value)||e.scrollIntoView({behavior:"smooth",block:"end"})}))},Ee=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&b.value++}))})),Ue=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&k.value++}))}));L((()=>{Be()})),O((()=>{De.value&&Ee.unobserve(De.value),Le.value&&Ue.unobserve(Le.value)}));const Ne=ce(((e,a)=>{if(e.like=!e.like,e.unlike=!1,_czc.push(["_trackEvent","qanything","问答页面","点赞","",""]),e.like){a.target.parentNode.style.animation="shake ease-in .5s";const e=setTimeout((()=>{clearTimeout(e),a.target.parentNode.style.animation=""}),600)}}),800),Pe=e=>{h.value.push({answer:"",question:e,onlySearch:V.value.capabilities.onlySearch,type:"ai",copied:!1,like:!1,unlike:!1,source:[],showTools:!1})},Qe=new ne,Me=e=>{De.value=e},Re=e=>{Le.value=e},Ve=(e,a,t)=>{try{z(e,a,t)}catch(s){y.error(s.msg||"更新对话失败")}};const Ke=()=>{Oe&&Oe.abort("停止对话"),l.done(),Se.value=!1,h.value[h.value.length-1].showTools=!0},ba=g([]);q((()=>r),(()=>{}),{immediate:!0,deep:!0});const ya=async()=>{if(!xe.value.trim().length)return;if(Se.value)return void y.warn("正在聊天中...请等待结束");if(!(await La()))return void y.error("模型设置错误，请先检查模型配置");if(!((xe.value.match(/@/g)||[]).length<=10))return void y.error("不可@超过10个");if(function(){if(!r.value.length)return;const e=[];r.value.forEach((a=>{c.value.some((e=>e.kb_id===a))&&e.push(a)})),r.value=e,R.value.forEach((e=>{null!==f.value&&e.historyId===f.value&&e.kbIds.join("")!==r.value.join("")&&Ve(e.title,e.historyId,r.value)}))}(),!r.value.length)return y.warning(s.chooseError);y.info({content:"zh"===s.type?`已选择 ${r.value.length} 个知识库进行问答`:` ${r.value.length} knowledge base has been selected`,icon:" "});const e=xe.value;(e=>{try{if(null!==f.value)return;e.length>100&&(e=e.substring(0,100)),f.value=K(e),Ve(e,f.value,r.value)}catch(a){y.error(a.msg||"创建对话失败")}})(e),xe.value="",(e=>{h.value.push({question:e,type:"user"}),Be()})(e),te(f.value,h.value),Se.value=!0,Oe=new AbortController;const a={kb_ids:r.value,history:je.value,question:e,streaming:!1===V.value.capabilities.onlySearch,networking:V.value.capabilities.networkSearch,product_source:"saas",rerank:!0,only_need_search_results:V.value.capabilities.onlySearch,hybrid_search:!0,max_token:V.value.maxToken,api_base:V.value.apiBase,api_key:V.value.apiKey,model:V.value.apiModelName,api_context_length:V.value.apiContextLength,chunk_size:V.value.chunkSize,top_p:V.value.top_P,top_k:V.value.top_K,temperature:V.value.temperature};if(V.value.capabilities.onlySearch){Qe.addChatSetting(V.value),Pe(e);try{const e=await ie(await Y.sendQuestion(a,{signal:Oe.signal}));200===e.code&&(h.value[h.value.length-1].answer=(null==e?void 0:e.source_documents.length)?s.searchCompleted:s.searchNotFound,h.value[h.value.length-1].source=null==e?void 0:e.source_documents)}catch(t){h.value[h.value.length-1].answer=t.msg||"error"}Se.value=!1,h.value[h.value.length-1].showTools=!0,te(f.value,h.value),await A((()=>{Be()}))}else ee(Z+"/local_doc_qa/local_doc_chat",{method:"POST",headers:{"Content-Type":"application/json",Accept:["text/event-stream","application/json"],Authorization:`Bearer ${U.get("token")}`},openWhenHidden:!0,body:JSON.stringify({user_id:J,user_info:$,...a}),signal:Oe.signal,onopen(a){Pe(e),a.ok&&"text/event-stream"===a.headers.get("content-type")?(Qe.addChatSetting(V.value),l.start()):"application/json"===a.headers.get("content-type")&&l.add("Error 请检查模型是否配置正确")},onmessage(e){var a,t;const s=JSON.parse(e.data);if(200==(null==s?void 0:s.code)&&(null==s?void 0:s.response)&&"success"===s.msg)l.add(null==s?void 0:s.response),Be();else{delete s.time_record.time_usage.retriever_search_by_milvus,Qe.addTime(s.time_record.time_usage),Qe.addToken(s.time_record.token_usage),Qe.addDate(Date.now())}(null==(a=null==s?void 0:s.source_documents)?void 0:a.length)&&(h.value[h.value.length-1].source=null==s?void 0:s.source_documents),(null==(t=null==s?void 0:s.show_images)?void 0:t.length)&&(null==s||s.show_images.map((e=>{l.add(e)})))},onclose(e){l.done(),Oe.abort(),Se.value=!1,h.value[h.value.length-1].showTools=!0,h.value.at(-1).itemInfo=Qe.getChatInfo(),te(f.value,h.value),A((()=>{Be()}))},onerror(e){throw null==l||l.done(),null==Oe||Oe.abort(),Se.value=!1,h.value[h.value.length-1].showTools=!0,y.error(e.msg||"出错了"),te(f.value,h.value),A((()=>{Be()})),e}})},ka=async()=>{if(0!==r.value.length)try{const{bot_id:e}=await ie(await Y.createBot({bot_name:"bot-"+re(Date.now()),description:"来源: 知识库创建-"+re(Date.now())}));await ie(await Y.updateBot({bot_id:e,kb_ids:[...r.value],only_need_search_results:V.value.capabilities.onlySearch,networking:V.value.capabilities.networkSearch,api_base:V.value.apiBase,api_key:V.value.apiKey,api_context_length:V.value.apiContextLength,top_p:V.value.top_P,temperature:V.value.temperature,top_k:V.value.top_K,model:V.value.apiModelName,max_token:V.value.maxToken,hybrid_search:V.value.capabilities.mixedSearch,chunk_size:V.value.maxToken,rerank:V.value.capabilities.rerank})),we(!0);const{origin:a,pathname:t}=window.location;Ce(`${a+t}#/bots/${e}/share`)}catch(e){y.error((null==e?void 0:e.msg)||"分享失败")}},{showModal:_a}=_(X()),wa=g(!1),Ca=g(""),Ia=g(""),xa=()=>{Se.value||(Ia.value="download",_a.value=!0,Ca.value=s.saveTip)},ja=()=>{Se.value||(Ia.value="delete",_a.value=!0,Ca.value=s.clearTip)},Sa=async()=>{if(wa.value=!0,"download"===Ia.value)try{const e=document.getElementById("chat-ul"),a=(await le(e,{useCORS:!0})).toDataURL("image/png"),t=document.createElement("a");t.style.display="none",t.href=a,t.setAttribute("download","chat-shot.png"),void 0===t.download&&t.setAttribute("target","_blank"),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(a),y.success("下载成功"),Promise.resolve()}catch(e){y.error(e.message||e.msg||"出错了")}else"delete"===Ia.value&&(fe(f.value),f.value=null,h.value=[]);Ia.value="",Ca.value="",wa.value=!1,_a.value=!1},{showSettingModal:Aa}=_(X()),Da=g(),La=()=>Da.value.handleOk();let Oa=["md","txt","pdf","jpg","png","jpeg","doc","docx","xls","xlsx","ppt","pptx","jsonl","csv","eml"];const qa=e=>{if(!e)return!1;const a=e.split(".");if(a.length){const e=a.pop();return!!Oa.includes(e)}return!1},Ta=e=>{qa(e.file_name)&&async function(e){try{ke(null);const a=await ie(await Y.getFile({file_id:e.file_id})),t=e.file_name.split(".").pop(),s=function(e){const a=Oa.indexOf(e);return Ba[a]}(t);if(ye(t),ke(`data:${s};base64,${a.file_base64}`),"txt"===t||"md"===t||"csv"===t||"eml"===t){const e=atob(a.file_base64),t=decodeURIComponent(escape(e));_e(t),be(!0)}else be(!0)}catch(a){y.error(a.msg||"获取文件失败")}}(e)};let Ba=["text/markdown","text/plain","application/pdf","image/jpeg","image/png","image/jpeg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/jsonl","text/csv","message/rfc822"];function Ea(){}return(e,a)=>{const l=B,o=ge;return m(),u(x,null,[i(He,{observer:v(Ee),"observe-dom":v(De),"qa-observe-dom":v(Le),"qa-observer":v(Ue),"show-loading":v(Se),onScrollBottom:Be,onSetObserveDom:Me,onSetQaObserverDom:Re,onClearHistory:Ea},null,8,["observer","observe-dom","qa-observe-dom","qa-observer","show-loading"]),d("div",ze,[d("div",Ye,[d("div",{id:"chat",ref_key:"chatContainer",ref:qe,class:"chat showSider"},[d("ul",{id:"chat-ul",ref_key:"scrollDom",ref:Te},[(m(!0),u(x,null,j(v(h),((e,a)=>{var t,l;return m(),u("li",{key:a},["user"===e.type?(m(),u("div",$e,[Je,d("p",Ze,p(e.question),1)])):(m(),u("div",We,[Xe,d("div",Ge,[d("div",ea,[d("p",{class:w(["question-text",[e.source.length||(null==(t=null==e?void 0:e.picList)?void 0:t.length)?"":"change-radius",e.showTools?"":"flashing"]])},[i(de,{content:e.answer.toString()},null,8,["content"]),Object.keys((null==(l=null==e?void 0:e.itemInfo)?void 0:l.tokenInfo)||{}).length?(m(),F(ae,{key:0,"chat-item-info":e.itemInfo},null,8,["chat-item-info"])):S("",!0)],2),e.source.length?(m(),u(x,{key:0},[d("div",{class:w(["source-total",v(Ae).includes(a)?"":"source-total-last"])},["zh"===v(Ie)?(m(),u("span",aa," 找到了"+p(e.source.length)+"个信息来源： ",1)):(m(),u("span",ta," Found "+p(e.source.length)+" source of information ",1)),N(i(I,{name:"down",onClick:e=>(e=>{Ae.value.push(e)})(a)},null,8,["onClick"]),[[P,!v(Ae).includes(a)]]),N(i(I,{name:"up",onClick:e=>(e=>{Ae.value=Ae.value.filter((a=>a!==e))})(a)},null,8,["onClick"]),[[P,v(Ae).includes(a)]])],2),N(d("div",sa,[(m(!0),u(x,null,j(e.source,((a,t)=>(m(),u("div",{key:t,class:"data-source"},[N(d("p",la,[d("span",oa,p(v(s).dataSource)+p(t+1)+":",1),a.file_url.startsWith("http")?(m(),u("a",{key:0,href:a.file_url,target:"_blank"},p(a.file_name),9,na)):(m(),u("span",{key:1,class:w(["file",qa(a.file_name)?"filename-active":""]),onClick:e=>Ta(a)},p(a.file_name),11,ia)),N(i(I,{name:"iconup",onClick:a=>((e,a)=>{e.source[a].showDetailDataSource=!1})(e,t)},null,8,["onClick"]),[[P,a.showDetailDataSource]]),N(i(I,{name:"icondown",onClick:a=>((e,a)=>{e.source[a].showDetailDataSource=!e.source[a].showDetailDataSource})(e,t)},null,8,["onClick"]),[[P,!a.showDetailDataSource]])],512),[[P,a.file_name]]),i(Q,{name:"sourceitem"},{default:T((()=>[N(d("div",ra,[i(de,{content:a.content},null,8,["content"]),d("p",ca,[d("span",ua,p(v(s).correlation),1),C(" "+p(a.score),1)])],512),[[P,a.showDetailDataSource]])])),_:2},1024)])))),128))],512),[[P,v(Ae).includes(a)]])],64)):S("",!0),e.showTools?(m(),u("div",da,[d("div",{class:"reload-box",onClick:a=>(e=>{xe.value=e.question,ya()})(e)},[i(I,{name:"reload"}),d("span",pa,p(v(s).regenerate),1)],8,va),d("div",ma,[i(I,{style:M({color:e.copied?"#4D71FF":""}),name:"copy",onClick:a=>(e=>{H(e.answer).then((()=>{e.copied=!e.copied,y.success(s.copySuccess,1);const a=setTimeout((()=>{clearTimeout(a),e.copied=!e.copied}),1e3)})).catch((()=>{y.error(s.copyFailed,1)}))})(e)},null,8,["style","onClick"]),i(I,{style:M({color:e.like?"#4D71FF":""}),name:"like",onClick:a=>v(Ne)(e,a)},null,8,["style","onClick"]),i(I,{style:M({color:e.unlike?"#4D71FF":""}),name:"unlike",onClick:a=>(e=>{e.unlike=!e.unlike,e.like=!1,_czc.push(["_trackEvent","qanything","问答页面","点踩","",""])})(e)},null,8,["style","onClick"])])])):S("",!0)])])]))])})),128))],512)],512),v(Se)?(m(),u("div",ha,[i(l,{onClick:Ke},{icon:T((()=>[i(I,{name:"stop",class:w(v(Se)?"loading":"")},null,8,["class"])])),default:T((()=>[C(" "+p(v(s).stop),1)])),_:1})])):S("",!0),d("div",ga,[d("div",fa,[i(he,{"input-value":v(xe),"onUpdate:inputValue":a[1]||(a[1]=e=>E(xe)?xe.value=e:null),options:v(ba),onSend:ya},{default:T((()=>[i(o,null,{content:T((()=>[C(p(v(r).length?v(s).chatShare:v(s).chatShareNoChatId),1)])),default:T((()=>[d("span",{class:w(["question-icon",v(Se)||!v(r).length?"isPreventClick":""]),onClick:ka},[i(I,{name:"chat-share"})],2)])),_:1}),i(o,{placement:"topLeft"},{content:T((()=>[C(p(v(s).chatToPic),1)])),default:T((()=>[d("span",{class:w(["question-icon",v(Se)?"isPreventClick":""]),onClick:xa},[i(I,{name:"chat-download"})],2)])),_:1}),i(o,null,{content:T((()=>[C(p(v(s).clearChat),1)])),default:T((()=>[d("span",{class:w(["question-icon",v(Se)?"isPreventClick":""]),onClick:ja},[i(I,{name:"chat-delete"})],2)])),_:1}),i(o,null,{content:T((()=>[C(p(v(s).modelSettingTitle),1)])),default:T((()=>[d("span",{class:"question-icon",onClick:a[0]||(a[0]=e=>{return a=!0,void(Aa.value=a);var a})},[i(I,{name:"chat-setting"})])])),_:1}),i(l,{type:"primary",disabled:v(Se),shape:"circle",onClick:ya},{default:T((()=>[i(I,{name:"sendplane"})])),_:1},8,["disabled"])])),_:1},8,["input-value","options"])])])]),d("div",{class:"scroll-btn-div"},[d("img",{class:"avatar",src:oe,alt:"滑到底部",onClick:Be})])]),i(ve,{ref_key:"chatSettingForDialogRef",ref:Da},null,512),i(G,{content:v(Ca),"confirm-loading":v(wa),onOk:Sa},null,8,["content","confirm-loading"]),i(t)],64)}}}),[["__scopeId","data-v-2977ec87"]]),ya={class:"input-wrapper"},ka=h(c({__name:"AddInput",setup(t){const{getList:n,setCurrentId:r,setCurrentKbName:c,setDefault:u}=a(),{selectList:h}=_(a()),{setModalVisible:f}=e(),{modalVisible:b}=_(e()),{setEditModalVisible:k}=s(),{editModalVisible:w}=_(s()),I=o().common,x=g(""),j=g("0"),S=async()=>{if(x.value.length)try{const e=await(async(e=!1)=>await ie(await Y.createKb({kb_name:x.value,is_faq:e})))("0"!==j.value);x.value="",r(null==e?void 0:e.kb_id),c(null==e?void 0:e.kb_name),h.value.push(null==e?void 0:e.kb_id),await n(),"0"===j.value?f(!b.value):k(!w.value),u(l.optionlist)}catch(e){y.error(e.msg||I.error)}else y.error(I.errorKnowledge)};return(e,a)=>{const t=B,s=R,l=V;return m(),F(l,{theme:{token:{colorPrimary:"#5a47e5"}}},{default:T((()=>[d("div",ya,[i(s,{value:v(x),"onUpdate:value":a[0]||(a[0]=e=>E(x)?x.value=e:null),class:"add-input",placeholder:v(I).newPlaceholder},{suffix:T((()=>[i(t,{type:"primary",class:"add-button",onClick:S},{default:T((()=>[C(p(v(I).new),1)])),_:1})])),_:1},8,["value","placeholder"])])])),_:1})}}}),[["__scopeId","data-v-9f08b568"]]),_a=["onClick"],wa={class:"tools-box"},Ca=["onClick"],Ia={class:"tool-name"},xa=["onClick"],ja={class:"tool-name"},Sa={class:"content"},Aa={class:"title"},Da={class:"normal"},La={class:"title-text"},Oa={class:"editing"},qa={class:"title-text"},Ta={class:"icon-box"},Ba={key:1,class:"content"},Ea={class:"title"},Ua={class:"normal"},Fa={class:"title-text"},Na=h(c({__name:"SiderCard",props:{list:{type:Array,require:!0,default:()=>[]},style:{type:Object,default:()=>({width:"232px"})}},setup(e){const t=o().common,{setShowDeleteModal:s,setCurrentId:n,setCurrentKbName:r,setDefault:c}=a(),{showDeleteModal:h,selectList:f,currentId:b}=_(a()),{userInfo:k}=H(),C=e,S=g(""),A=D((()=>C.list.map((e=>{if(!e.kb_id.includes("_QUICK"))return e}))));return(e,a)=>{const o=I,g=R,_=ge;return m(!0),u(x,null,j(v(A),((e,a)=>(m(),u("div",{key:a,class:w([{active:v(f).includes(e.kb_id),"card-option-active":v(b)===e.kb_id},"card"]),style:M(C.style),onClick:a=>(e=>{if(e.edit)return;const a=e.kb_id;if(f.value.includes(a)){const e=f.value.findIndex((e=>e===a));-1!=e&&f.value.splice(e,1)}else f.value.push(a)})(e)},["admin"===v(k).role||"superadmin"===v(k).role?(m(),F(_,{key:0,"overlay-class-name":"card-hover",placement:"right"},{content:T((()=>[d("div",wa,[d("ul",null,[d("li",{onClick:a=>(e=>{n(e.kb_id),r(e.kb_name),c(l.optionlist)})(e)},[i(o,{class:"edit",name:"icon-manage"}),d("span",Ia,p(v(t).manage),1)],8,Ca),d("li",{onClick:a=>(e=>{s(!h.value),n(e.kb_id)})(e)},[i(o,{class:"delete",name:"delete"}),d("span",ja,p(v(t).delete),1)],8,xa)])])])),default:T((()=>[d("div",Sa,[d("div",Aa,[N(d("div",Da,[d("p",La,p(e.kb_name),1)],512),[[P,!e.edit]]),N(d("div",Oa,[d("p",qa,[i(g,{value:e.kb_name,"onUpdate:value":a=>e.kb_name=a,type:"text"},null,8,["value","onUpdate:value"])]),d("span",Ta,[i(o,{class:"edit",name:"card-confirm",onClick:K((a=>(async e=>{try{await ie(await Y.kbConfig({kb_id:e.kb_id,new_kb_name:e.kb_name})),S.value="",e.edit=!e.edit,y.success(t.renameSucceeded)}catch(a){y.error(a.msg||t.renameFailed)}})(e)),["stop"])},null,8,["onClick"]),i(o,{class:"delete",name:"card-cancel",onClick:K((a=>(e=>{e.kb_name=S.value,S.value="",e.edit=!e.edit})(e)),["stop"])},null,8,["onClick"])])],512),[[P,e.edit]])])])])),_:2},1024)):(m(),u("div",Ba,[d("div",Ea,[d("div",Ua,[d("p",Fa,p(e.kb_name),1)])])]))],14,_a)))),128)}}}),[["__scopeId","data-v-60cfcd52"]]),Pa={class:"sidebar-wrapper"},Qa={class:"sidebar-content"},Ma={class:"content",style:{"margin-top":"20px"}},Ra=h(c({__name:"CollapsibleSidebar",setup(e,{expose:t}){const s=g(!1),{knowledgeBaseList:l,currentKbName:o}=_(a()),n=()=>{s.value=!s.value};return t({isCollapsed:s,toggleSidebar:n}),(e,a)=>(m(),u("div",Pa,[d("div",{class:w(["sidebar-toggle",{collapsed:s.value}]),onClick:n},[s.value?(m(),F(v(be),{key:0})):(m(),F(v(ye),{key:1}))],2),d("div",{class:w(["sidebar",{"sidebar-collapsed":s.value}])},[d("div",Qa,[i(ka),d("div",Ma,[i(Na,{list:v(l)},null,8,["list"])]),z(e.$slots,"default",{},void 0,!0)])],2)]))}}),[["__scopeId","data-v-dc5ee4d6"]]),Va={class:"page"},Ha={class:"layout-wrapper"},Ka=(e=>(f("data-v-4f216b34"),e=e(),b(),e))((()=>d("div",{class:"sidebar-menu"},null,-1))),za={key:0,class:"initing"},Ya=h(c({__name:"Home",setup(e){const{showDefault:t}=_(a()),{setDefault:s,getList:o}=a(),n=g(),r=D((()=>{var e;return null==(e=n.value)?void 0:e.isCollapsed})),c=e=>{s(e),o()};return L((()=>{o()})),(e,a)=>(m(),u("div",Va,[d("div",Ha,[i(Ra,{ref_key:"sidebarRef",ref:n},{default:T((()=>[Ka])),_:1},512),d("div",{class:w(["container",{"container-expanded":r.value}])},[v(t)===v(l).initing?(m(),u("div",za)):S("",!0),v(t)===v(l).default?(m(),F(Ue,{key:1,onChange:c})):v(t)===v(l).normal?(m(),F(ba,{key:2})):v(t)===v(l).optionlist?(m(),F(fe,{key:3})):S("",!0)],2)])]))}}),[["__scopeId","data-v-4f216b34"]]);export{Ya as default};
