import{v as e,ab as t,ac as a,ad as l,ae as s,af as r,ag as o,ah as n,ai as i,aj as c,d as u,s as d,x as p,c as v,Q as m,H as g,ak as f,z as y,m as k,q as h,al as b,am as w,t as C,an as x,ao as $,ap as _,aq as S,I,a5 as O,E as j,a2 as z,a as P,o as L,l as T,K as A,C as D,U as N,e as M,w as E,b as F,O as W,a0 as R,T as U,W as q,a7 as X,X as B,M as H,V,B as Q,a9 as K,g as G,Z as J,j as Y,p as Z,i as ee,F as te,S as ae,k as le,ar as se,$ as re,R as oe}from"./index-Dnd1wrVz.js";import{u as ne,a as ie,c as ce}from"./urlConfig-BRkfAQUm.js";import{_ as ue,b as de,u as pe,a as ve,c as me,p as ge}from"./useUploadFiles-Cz8mgLOH.js";import{d as fe,r as ye}from"./utils-Dy9G1Irh.js";import{g as ke}from"./index-BGs17W_C.js";import{C as he}from"./CheckOutlined-BY4Hd7YC.js";import{_ as be}from"./index-BOQF8sB2.js";import{u as we}from"./useChatSetting-BAUL9MYY.js";import{u as Ce,_ as xe}from"./useChatSource-BAwYmxq4.js";import{S as $e}from"./index-lv1W1ebf.js";import{_ as _e,a as Se,T as Ie}from"./index-B_1x0Xrf.js";import{L as Oe}from"./ChatInfoPanel-FjtXze9J.js";import{L as je}from"./LeftOutlined-CbcobKim.js";import{T as ze,M as Pe}from"./TeamOutlined-C1WkXm__.js";import{Q as Le}from"./index-Wcu94PXT.js";import{S as Te,a as Ae}from"./index-DI3wlhMT.js";import{S as De}from"./index-CXl91b5n.js";import{U as Ne,P as Me}from"./UserOutlined-sw_XmNpd.js";const Ee=["normal","exception","active","success"],Fe=()=>({prefixCls:String,type:a(),percent:Number,format:n(),status:a(),showInfo:o(),strokeWidth:Number,strokeLinecap:a(),strokeColor:r(),trailColor:String,width:Number,success:s(),gapDegree:Number,gapPosition:a(),size:l([String,Number,Array]),steps:Number,successPercent:Number,title:String,progressStatus:a()});function We(e){return!e||e<0?0:e>100?100:e}function Re(e){let{success:t,successPercent:a}=e,l=a;return t&&"progress"in t&&(i(!1,"Progress","`success.progress` is deprecated. Please use `success.percent` instead."),l=t.progress),t&&"percent"in t&&(l=t.percent),l}const Ue=(e,t,a)=>{var l,s,r,o;let n=-1,i=-1;if("step"===t){const t=a.steps,l=a.strokeWidth;"string"==typeof e||void 0===e?(n="small"===e?2:14,i=null!=l?l:8):"number"==typeof e?[n,i]=[e,e]:[n=14,i=8]=e,n*=t}else if("line"===t){const t=null==a?void 0:a.strokeWidth;"string"==typeof e||void 0===e?i=t||("small"===e?6:8):"number"==typeof e?[n,i]=[e,e]:[n=-1,i=8]=e}else"circle"!==t&&"dashboard"!==t||("string"==typeof e||void 0===e?[n,i]="small"===e?[60,60]:[120,120]:"number"==typeof e?[n,i]=[e,e]:(n=null!==(s=null!==(l=e[0])&&void 0!==l?l:e[1])&&void 0!==s?s:120,i=null!==(o=null!==(r=e[0])&&void 0!==r?r:e[1])&&void 0!==o?o:120));return{width:n,height:i}};const qe=(e,t)=>{const{from:a=c.blue,to:l=c.blue,direction:s=("rtl"===t?"to left":"to right")}=e,r=function(e,t){var a={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(l=Object.getOwnPropertySymbols(e);s<l.length;s++)t.indexOf(l[s])<0&&Object.prototype.propertyIsEnumerable.call(e,l[s])&&(a[l[s]]=e[l[s]])}return a}(e,["from","to","direction"]);if(0!==Object.keys(r).length){return{backgroundImage:`linear-gradient(${s}, ${(e=>{let t=[];return Object.keys(e).forEach((a=>{const l=parseFloat(a.replace(/%/g,""));isNaN(l)||t.push({key:l,value:e[a]})})),t=t.sort(((e,t)=>e.key-t.key)),t.map((e=>{let{key:t,value:a}=e;return`${a} ${t}%`})).join(", ")})(r)})`}}return{backgroundImage:`linear-gradient(${s}, ${a}, ${l})`}},Xe=u({compatConfig:{MODE:3},name:"ProgressLine",inheritAttrs:!1,props:d(d({},Fe()),{strokeColor:r(),direction:a()}),setup(e,t){let{slots:a,attrs:l}=t;const s=p((()=>{const{strokeColor:t,direction:a}=e;return t&&"string"!=typeof t?qe(t,a):{backgroundColor:t}})),r=p((()=>"square"===e.strokeLinecap||"butt"===e.strokeLinecap?0:void 0)),o=p((()=>e.trailColor?{backgroundColor:e.trailColor}:void 0)),n=p((()=>{var t;return null!==(t=e.size)&&void 0!==t?t:[-1,e.strokeWidth||("small"===e.size?6:8)]})),i=p((()=>Ue(n.value,"line",{strokeWidth:e.strokeWidth}))),c=p((()=>{const{percent:t}=e;return d({width:`${We(t)}%`,height:`${i.value.height}px`,borderRadius:r.value},s.value)})),u=p((()=>Re(e))),f=p((()=>{const{success:t}=e;return{width:`${We(u.value)}%`,height:`${i.value.height}px`,borderRadius:r.value,backgroundColor:null==t?void 0:t.strokeColor}})),y={width:i.value.width<0?"100%":i.value.width,height:`${i.value.height}px`};return()=>{var t;return v(m,null,[v("div",g(g({},l),{},{class:[`${e.prefixCls}-outer`,l.class],style:[l.style,y]}),[v("div",{class:`${e.prefixCls}-inner`,style:o.value},[v("div",{class:`${e.prefixCls}-bg`,style:c.value},null),void 0!==u.value?v("div",{class:`${e.prefixCls}-success-bg`,style:f.value},null):null])]),null===(t=a.default)||void 0===t?void 0:t.call(a)])}}});let Be=0;function He(e){return+e.replace("%","")}function Ve(e){return Array.isArray(e)?e:[e]}function Qe(e,t,a,l){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const r=50-l/2;let o=0,n=-r,i=0,c=-2*r;switch(arguments.length>5?arguments[5]:void 0){case"left":o=-r,n=0,i=2*r,c=0;break;case"right":o=r,n=0,i=-2*r,c=0;break;case"bottom":n=r,c=2*r}const u=`M 50,50 m ${o},${n}\n   a ${r},${r} 0 1 1 ${i},${-c}\n   a ${r},${r} 0 1 1 ${-i},${c}`,d=2*Math.PI*r;return{pathString:u,pathStyle:{stroke:a,strokeDasharray:`${t/100*(d-s)}px ${d}px`,strokeDashoffset:`-${s/2+e/100*(d-s)}px`,transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s"}}}const Ke=u({compatConfig:{MODE:3},name:"VCCircle",props:y({gapDegree:Number,gapPosition:{type:String},percent:{type:[Array,Number]},prefixCls:String,strokeColor:{type:[Object,String,Array]},strokeLinecap:{type:String},strokeWidth:Number,trailColor:String,trailWidth:Number,transition:String},{percent:0,prefixCls:"vc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1}),setup(a){Be+=1;const l=e(Be),s=p((()=>Ve(a.percent))),r=p((()=>Ve(a.strokeColor))),[o,n]=(()=>{const a=e(new Map);return t((()=>{a.value=new Map})),[e=>t=>{a.value.set(e,t)},a]})();(t=>{const a=e(null);f((()=>{const e=Date.now();let l=!1;t.value.forEach((t=>{const s=(null==t?void 0:t.$el)||t;if(!s)return;l=!0;const r=s.style;r.transitionDuration=".3s, .3s, .3s, .06s",a.value&&e-a.value<100&&(r.transitionDuration="0s, 0s")})),l&&(a.value=Date.now())}))})(n);const i=()=>{const{prefixCls:e,strokeWidth:t,strokeLinecap:n,gapDegree:i,gapPosition:c}=a;let u=0;return s.value.map(((a,s)=>{const d=r.value[s]||r.value[r.value.length-1],p="[object Object]"===Object.prototype.toString.call(d)?`url(#${e}-gradient-${l.value})`:"",{pathString:m,pathStyle:f}=Qe(u,a,d,t,i,c);u+=a;const y={key:s,d:m,stroke:p,"stroke-linecap":n,"stroke-width":t,opacity:0===a?0:1,"fill-opacity":"0",class:`${e}-circle-path`,style:f};return v("path",g({ref:o(s)},y),null)}))};return()=>{const{prefixCls:e,strokeWidth:t,trailWidth:s,gapDegree:o,gapPosition:n,trailColor:c,strokeLinecap:u,strokeColor:d}=a,p=function(e,t){var a={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(l=Object.getOwnPropertySymbols(e);s<l.length;s++)t.indexOf(l[s])<0&&Object.prototype.propertyIsEnumerable.call(e,l[s])&&(a[l[s]]=e[l[s]])}return a}(a,["prefixCls","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","strokeColor"]),{pathString:m,pathStyle:f}=Qe(0,100,c,t,o,n);delete p.percent;const y=r.value.find((e=>"[object Object]"===Object.prototype.toString.call(e))),k={d:m,stroke:c,"stroke-linecap":u,"stroke-width":s||t,"fill-opacity":"0",class:`${e}-circle-trail`,style:f};return v("svg",g({class:`${e}-circle`,viewBox:"0 0 100 100"},p),[y&&v("defs",null,[v("linearGradient",{id:`${e}-gradient-${l.value}`,x1:"100%",y1:"0%",x2:"0%",y2:"0%"},[Object.keys(y).sort(((e,t)=>He(e)-He(t))).map(((e,t)=>v("stop",{key:t,offset:e,"stop-color":y[e]},null)))])]),v("path",k,null),i().reverse()])}}}),Ge=u({compatConfig:{MODE:3},name:"ProgressCircle",inheritAttrs:!1,props:y(d(d({},Fe()),{strokeColor:r()}),{trailColor:null}),setup(e,t){let{slots:a,attrs:l}=t;const s=p((()=>{var t;return null!==(t=e.width)&&void 0!==t?t:120})),r=p((()=>{var t;return null!==(t=e.size)&&void 0!==t?t:[s.value,s.value]})),o=p((()=>Ue(r.value,"circle"))),n=p((()=>e.gapDegree||0===e.gapDegree?e.gapDegree:"dashboard"===e.type?75:void 0)),i=p((()=>({width:`${o.value.width}px`,height:`${o.value.height}px`,fontSize:.15*o.value.width+6+"px"}))),u=p((()=>{var t;return null!==(t=e.strokeWidth)&&void 0!==t?t:Math.max(3/o.value.width*100,6)})),d=p((()=>e.gapPosition||"dashboard"===e.type&&"bottom"||void 0)),f=p((()=>function(e){let{percent:t,success:a,successPercent:l}=e;const s=We(Re({success:a,successPercent:l}));return[s,We(We(t)-s)]}(e))),y=p((()=>"[object Object]"===Object.prototype.toString.call(e.strokeColor))),k=p((()=>function(e){let{success:t={},strokeColor:a}=e;const{strokeColor:l}=t;return[l||c.green,a||null]}({success:e.success,strokeColor:e.strokeColor}))),h=p((()=>({[`${e.prefixCls}-inner`]:!0,[`${e.prefixCls}-circle-gradient`]:y.value})));return()=>{var t;const s=v(Ke,{percent:f.value,strokeWidth:u.value,trailWidth:u.value,strokeColor:k.value,strokeLinecap:e.strokeLinecap,trailColor:e.trailColor,prefixCls:e.prefixCls,gapDegree:n.value,gapPosition:d.value},null);return v("div",g(g({},l),{},{class:[h.value,l.class],style:[l.style,i.value]}),[o.value.width<=20?v(be,null,{default:()=>[v("span",null,[s])],title:a.default}):v(m,null,[s,null===(t=a.default)||void 0===t?void 0:t.call(a)])])}}}),Je=u({compatConfig:{MODE:3},name:"Steps",props:d(d({},Fe()),{steps:Number,strokeColor:l(),trailColor:String}),setup(e,t){let{slots:a}=t;const l=p((()=>Math.round(e.steps*((e.percent||0)/100)))),s=p((()=>{var t;return null!==(t=e.size)&&void 0!==t?t:["small"===e.size?2:14,e.strokeWidth||8]})),r=p((()=>Ue(s.value,"step",{steps:e.steps,strokeWidth:e.strokeWidth||8}))),o=p((()=>{const{steps:t,strokeColor:a,trailColor:s,prefixCls:o}=e,n=[];for(let e=0;e<t;e+=1){const i=Array.isArray(a)?a[e]:a,c={[`${o}-steps-item`]:!0,[`${o}-steps-item-active`]:e<=l.value-1};n.push(v("div",{key:e,class:c,style:{backgroundColor:e<=l.value-1?i:s,width:r.value.width/t+"px",height:`${r.value.height}px`}},null))}return n}));return()=>{var t;return v("div",{class:`${e.prefixCls}-steps-outer`},[o.value,null===(t=a.default)||void 0===t?void 0:t.call(a)])}}}),Ye=new w("antProgressActive",{"0%":{transform:"translateX(-100%) scaleX(0)",opacity:.1},"20%":{transform:"translateX(-100%) scaleX(0)",opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}}),Ze=e=>{const{componentCls:t,iconCls:a}=e;return{[t]:d(d({},b(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize,marginInlineEnd:e.marginXS,marginBottom:e.marginXS},[`${t}-outer`]:{display:"inline-block",width:"100%"},[`&${t}-show-info`]:{[`${t}-outer`]:{marginInlineEnd:`calc(-2em - ${e.marginXS}px)`,paddingInlineEnd:`calc(2em + ${e.paddingXS}px)`}},[`${t}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:e.progressRemainingColor,borderRadius:e.progressLineRadius},[`${t}-inner:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorInfo}},[`${t}-success-bg, ${t}-bg`]:{position:"relative",backgroundColor:e.colorInfo,borderRadius:e.progressLineRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${t}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${t}-text`]:{display:"inline-block",width:"2em",marginInlineStart:e.marginXS,color:e.progressInfoTextColor,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[a]:{fontSize:e.fontSize}},[`&${t}-status-active`]:{[`${t}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.progressLineRadius,opacity:0,animationName:Ye,animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${t}-status-exception`]:{[`${t}-bg`]:{backgroundColor:e.colorError},[`${t}-text`]:{color:e.colorError}},[`&${t}-status-exception ${t}-inner:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorError}},[`&${t}-status-success`]:{[`${t}-bg`]:{backgroundColor:e.colorSuccess},[`${t}-text`]:{color:e.colorSuccess}},[`&${t}-status-success ${t}-inner:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorSuccess}}})}},et=e=>{const{componentCls:t,iconCls:a}=e;return{[t]:{[`${t}-circle-trail`]:{stroke:e.progressRemainingColor},[`&${t}-circle ${t}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${t}-circle ${t}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.colorText,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[a]:{fontSize:e.fontSize/e.fontSizeSM+"em"}},[`${t}-circle&-status-exception`]:{[`${t}-text`]:{color:e.colorError}},[`${t}-circle&-status-success`]:{[`${t}-text`]:{color:e.colorSuccess}}},[`${t}-inline-circle`]:{lineHeight:1,[`${t}-inner`]:{verticalAlign:"bottom"}}}},tt=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.progressRemainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.colorInfo}}}}}},at=e=>{const{componentCls:t,iconCls:a}=e;return{[t]:{[`${t}-small&-line, ${t}-small&-line ${t}-text ${a}`]:{fontSize:e.fontSizeSM}}}},lt=k("Progress",(e=>{const t=e.marginXXS/2,a=h(e,{progressLineRadius:100,progressInfoTextColor:e.colorText,progressDefaultColor:e.colorInfo,progressRemainingColor:e.colorFillSecondary,progressStepMarginInlineEnd:t,progressStepMinWidth:t,progressActiveMotionDuration:"2.4s"});return[Ze(a),et(a),tt(a),at(a)]}));const st=S(u({compatConfig:{MODE:3},name:"AProgress",inheritAttrs:!1,props:y(Fe(),{type:"line",percent:0,showInfo:!0,trailColor:null,size:"default",strokeLinecap:"round"}),slots:Object,setup(e,t){let{slots:a,attrs:l}=t;const{prefixCls:s,direction:r}=C("progress",e),[o,n]=lt(s),i=p((()=>Array.isArray(e.strokeColor)?e.strokeColor[0]:e.strokeColor)),c=p((()=>{const{percent:t=0}=e,a=Re(e);return parseInt(void 0!==a?a.toString():t.toString(),10)})),u=p((()=>{const{status:t}=e;return!Ee.includes(t)&&c.value>=100?"success":t||"normal"})),d=p((()=>{const{type:t,showInfo:a,size:l}=e,o=s.value;return{[o]:!0,[`${o}-inline-circle`]:"circle"===t&&Ue(l,"circle").width<=20,[`${o}-${"dashboard"===t?"circle":t}`]:!0,[`${o}-status-${u.value}`]:!0,[`${o}-show-info`]:a,[`${o}-${l}`]:l,[`${o}-rtl`]:"rtl"===r.value,[n.value]:!0}})),m=p((()=>"string"==typeof e.strokeColor||Array.isArray(e.strokeColor)?e.strokeColor:void 0));return()=>{const{type:t,steps:n,title:c}=e,{class:p}=l,f=function(e,t){var a={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(l=Object.getOwnPropertySymbols(e);s<l.length;s++)t.indexOf(l[s])<0&&Object.prototype.propertyIsEnumerable.call(e,l[s])&&(a[l[s]]=e[l[s]])}return a}(l,["class"]),y=(()=>{const{showInfo:t,format:l,type:r,percent:o,title:n}=e,i=Re(e);if(!t)return null;let c;const d=l||(null==a?void 0:a.format)||(e=>`${e}%`),p="line"===r;return l||(null==a?void 0:a.format)||"exception"!==u.value&&"success"!==u.value?c=d(We(o),We(i)):"exception"===u.value?c=v(p?x:$,null,null):"success"===u.value&&(c=v(p?_:he,null,null)),v("span",{class:`${s.value}-text`,title:void 0===n&&"string"==typeof c?c:void 0},[c])})();let k;return"line"===t?k=n?v(Je,g(g({},e),{},{strokeColor:m.value,prefixCls:s.value,steps:n}),{default:()=>[y]}):v(Xe,g(g({},e),{},{strokeColor:i.value,prefixCls:s.value,direction:r.value}),{default:()=>[y]}):"circle"!==t&&"dashboard"!==t||(k=v(Ge,g(g({},e),{},{prefixCls:s.value,strokeColor:i.value,progressStatus:u.value}),{default:()=>[y]})),o(v("div",g(g({role:"progressbar"},f),{},{class:[d.value,p],title:c}),[k]))}}}));var rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};function ot(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},l=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),l.forEach((function(t){nt(e,t,a[t])}))}return e}function nt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var it=function(e,t){var a=ot({},e,t.attrs);return v(I,ot({},a,{icon:rt}),null)};it.displayName="MinusCircleOutlined",it.inheritAttrs=!1;var ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"};function ut(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},l=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),l.forEach((function(t){dt(e,t,a[t])}))}return e}function dt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var pt=function(e,t){var a=ut({},e,t.attrs);return v(I,ut({},a,{icon:ct}),null)};pt.displayName="PlusCircleOutlined",pt.inheritAttrs=!1;var vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M892 772h-80v-80c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v80h-80c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h80v80c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-80h80c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM373.5 498.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.8-1.7-203.2 89.2-203.2 200 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.8-1.1 6.4-4.8 5.9-8.8zM824 472c0-109.4-87.9-198.3-196.9-200C516.3 270.3 424 361.2 424 472c0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C357 742.6 326 814.8 324 891.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5C505.8 695.7 563 672 624 672c110.4 0 200-89.5 200-200zm-109.5 90.5C690.3 586.7 658.2 600 624 600s-66.3-13.3-90.5-37.5a127.26 127.26 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4-.1 34.2-13.4 66.3-37.6 90.5z"}}]},name:"usergroup-add",theme:"outlined"};function mt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},l=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),l.forEach((function(t){gt(e,t,a[t])}))}return e}function gt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ft=function(e,t){var a=mt({},e,t.attrs);return v(I,mt({},a,{icon:vt}),null)};ft.displayName="UsergroupAddOutlined",ft.inheritAttrs=!1;const yt=O("useChunkView",(()=>({showChunkModel:e(!1)}))),kt=T(u({__name:"LoadingImg",setup(t){const a=e();return j((()=>{a.value&&a.value.classList.add("loading")})),z((()=>{a.value&&a.value.classList.remove("loading")})),(e,t)=>(L(),P("img",{ref_key:"loadingRef",ref:a,class:"img",src:ue,alt:"loading"},null,512))}}),[["__scopeId","data-v-f5b40af0"]]),ht={key:0,class:"container"},bt={class:"multi-color-progress"},wt={class:"progress-outer"},Ct={class:"progress"},xt={class:"percent"},$t={class:"percent-text"},_t=T(u({__name:"UploadProgress",setup(t){const{dataSource:a,totalStatus:l,kbTotal:s}=A(de()),r=ke().progress,o=e({green:0,yellow:0,red:0,gray:0}),n=e({green:0,yellow:0,red:0,gray:0}),i=e({green:0,yellow:0,red:0,gray:0});return D((()=>l),(()=>{(()=>{o.value=l.value;for(const t in o.value){const e=o.value[t]/s.value*100;n.value[t]=parseFloat(e.toFixed(2))}const e=100-Object.values(n.value).reduce(((e,t)=>e+t),0);e>0&&(n.value.gray+=e),i.value.green=n.value.green,i.value.red=n.value.red+i.value.green,i.value.yellow=n.value.yellow+i.value.red,i.value.gray=n.value.gray+i.value.yellow})()}),{immediate:!0,deep:!0}),(e,t)=>{const l=st,s=be;return 0!==M(a).length?(L(),P("div",ht,[v(s,{title:`${M(r).putStorage}: ${M(o).green},\n      ${M(r).inLine}: ${M(o).gray},\n      ${M(r).parsing}: ${M(o).yellow},\n      ${M(r).failure}: ${M(o).red}`},{default:E((()=>[F("div",bt,[F("div",wt,[F("div",Ct,[v(l,{percent:M(i).green,class:"progress-segment green",status:"active","stroke-color":"#52c41a"},null,8,["percent"]),v(l,{percent:M(i).red,class:"progress-segment red",status:"active","stroke-color":"#f5222d"},null,8,["percent"]),v(l,{percent:M(i).yellow,class:"progress-segment yellow",status:"active","stroke-color":"#FFEB3B"},null,8,["percent"]),v(l,{percent:M(i).gray,class:"progress-segment gray",status:"active","stroke-color":"#bfbfbf"},null,8,["percent"])])]),F("div",xt,[F("div",$t,W((M(n).green+M(n).red).toFixed(2))+"% ",1)])])])),_:1},8,["title"])])):N("",!0)}}}),[["__scopeId","data-v-4d89166a"]]),St={class:"container"},It={class:"scale"},Ot={class:"scale-text"},jt={class:"file-preview-content"},zt=(e=>(Z("data-v-5b124323"),e=e(),ee(),e))((()=>F("div",{class:"resize-handle"},null,-1))),Pt={class:"export"},Lt={style:{color:"#666","user-select":"text"}},Tt={class:"file-path"},At={key:1},Dt=["innerHTML"],Nt={key:2,class:"editable-row-operations"},Mt={key:0,class:"operation-div"},Et={class:"footer"},Ft=T(u({__name:"ChunkViewDialog",props:{kbId:{},fileId:{},fileName:{}},setup(t){const{showChunkModel:a}=A(yt()),{common:l}=ke(),{chatSettingFormActive:s}=A(we()),{setSourceType:r,setSourceUrl:o,setTextContent:n}=Ce(),i=t,{kbId:c,fileId:u,fileName:d}=R(i),p=e([{title:"编号",key:"id",dataIndex:"id",width:70},{title:"markdown预览",key:"content",dataIndex:"content",resizable:!0,width:150,minWidth:150},{title:"分析结果",key:"editContent",dataIndex:"editContent",resizable:!0,width:150,minWidth:150},{title:"操作",key:"operation",dataIndex:"operation",width:100}]),m=e(new Map),g=e=>{const t=e.key,a=e.content;m.value.has(t)?m.value.delete(t):m.value.set(t,a)},f=(...e)=>{e[2].map((e=>{const t=e.key,a=e.content;m.value.has(t)?m.value.delete(t):m.value.set(t,a)}))},y=()=>{let e="";[...m.value.values()].map((t=>{e+=t+"\n\n"})),k(e)},k=e=>{try{const t="output.txt",a=new File([e],t,{type:"text/plain;charset=utf-8"}),l=URL.createObjectURL(a);fe(l,t),m.value.clear()}catch(t){Y.error("download error")}},h=e(!1),b=e(!1),w=e({pageNum:1,pageSize:5,total:0,showSizeChanger:!1,showTotal:e=>`共 ${e} 条`}),C=e=>{w.value.pageNum=e.current,T(c.value,u.value)},x=e([]),$=e({}),_=e(1),S=e(""),I=()=>{a.value=!1,!b&&($.value={})},O=e(1),j=()=>{O.value+=.1},z=()=>{O.value<=.15||(O.value-=.1)},T=async(e,t)=>{h.value=!0;try{const a=await ye(await ne.getDocCompleted({kb_id:e,file_id:t,page_id:w.value.pageNum,page_limit:w.value.pageSize}));_.value=(w.value.pageNum-1)*w.value.pageSize+1,w.value.total=a.total_count,x.value=[],S.value=a.file_path,a.chunks.forEach((e=>{x.value.push({key:e.chunk_id,id:_.value++,content:e.page_content,editContent:e.page_content})}))}catch(a){Y.error(a.msg||"获取文档解析结果失败")}finally{h.value=!1}};D((()=>a.value),(()=>{a.value?(x.value=[],T(c.value,u.value),ee({file_id:u.value,file_name:d.value})):a.value||(O.value=1,x.value=[],_.value=1,w.value.pageNum=1,w.value.total=1,o(""),n(""),m.value.clear())}));let Z=["md","txt","pdf","jpg","png","jpeg","doc","docx","xls","xlsx","ppt","pptx","jsonl","csv","eml"];const ee=e=>{(e=>{if(!e)return!1;const t=e.split(".");if(t.length){const e=t.pop();return!!Z.includes(e)}return!1})(e.file_name)&&async function(e){try{o(null);const t=await ye(await ne.getFile({file_id:e.file_id})),a=e.file_name.split(".").pop(),l=function(e){const t=Z.indexOf(e);return te[t]}(a);if(r(a),o(`data:${l};base64,${t.file_base64}`),"txt"===a||"md"===a||"csv"===a||"eml"===a){const e=atob(t.file_base64),a=decodeURIComponent(escape(e));n(a)}}catch(t){Y.error(t.msg||"获取文件失败")}}(e)};let te=["text/markdown","text/plain","application/pdf","image/jpeg","image/png","image/jpeg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/jsonl","text/csv","message/rfc822"];const ae=e(null),le=e(0),se=(e,t)=>{le.value=ae.value.clientWidth;const a=e<t.width?"left":"right";(document.querySelector(".chunk-table").querySelector('.ant-table-cell[colstart="3"]').clientWidth>150||"left"===a)&&(t.width=e)},re=e(!1),oe=e(0),ie=e(0),ce=e("40%"),ue=e=>{e.target.classList.contains("resize-handle")&&(re.value=!0,oe.value=e.clientX,ie.value=e.target.parentElement.offsetWidth,window.addEventListener("mousemove",de),window.addEventListener("mouseup",pe))},de=e=>{if(re.value){const t=e.clientX-oe.value;(e=>{e>=300&&(ce.value=`${e}px`)})(ie.value+t)}},pe=()=>{re.value&&(re.value=!1,window.removeEventListener("mousemove",de),window.removeEventListener("mouseup",pe))};return(e,t)=>{const r=Q,o=be,n=J,i=Oe,c=_e,u=B,d=X;return L(),U(q,{to:"body"},[v(d,{theme:{token:{colorPrimary:"#5a47e5"}}},{default:E((()=>[v(u,{open:M(a),"onUpdate:open":t[0]||(t[0]=e=>H(a)?a.value=e:null),title:"切片分析结果",centered:"",width:"100%","wrap-class-name":"chunk-modal","destroy-on-close":"",footer:null,onCancel:I},{default:E((()=>[F("div",St,[F("div",{class:"file-preview",style:V({width:M(ce)}),onMousedown:ue},[F("div",It,[v(r,{shape:"circle",icon:K(M(pt)),onClick:j},null,8,["icon"]),F("span",Ot,W((100*M(O)).toFixed(0))+"%",1),v(r,{shape:"circle",icon:K(M(it)),onClick:z},null,8,["icon"])]),F("div",jt,[v($e,{"zoom-level":M(O)},null,8,["zoom-level"])]),zt],36),F("div",{ref_key:"tableDomRef",ref:ae,class:"chunk-table"},[F("div",Pt,[v(o,{color:"#fff",placement:"bottom"},{title:E((()=>[F("span",Lt,W(M(S)),1)])),default:E((()=>[F("span",Tt,"文件与解析结果所在目录: "+W(M(S)),1)])),_:1}),v(r,{type:"primary",onClick:y},{default:E((()=>[G(" 导出选中("+W(M(m).size)+") ",1)])),_:1})]),v(c,{columns:M(p),"data-source":M(x),bordered:"",scroll:{y:"calc(100vh - 32px - 40px - 42px - 64px - 56px - 42px - 48px)"},pagination:M(w),loading:M(h),"row-selection":{selectedRowKeys:[...M(m).keys()],onSelect:g,onSelectAll:f},onChange:C,onResizeColumn:se},{bodyCell:E((({column:e,record:t})=>{return["content"===e.dataIndex?(L(),U(xe,{key:0,content:M($)[t.key]?M($)[t.key].editContent:t.content},null,8,["content"])):N("",!0),"editContent"===e.dataIndex?(L(),P("div",At,[M($)[t.key]?(L(),U(n,{key:0,value:M($)[t.key][e.dataIndex],"onUpdate:value":a=>M($)[t.key][e.dataIndex]=a,style:{margin:"-5px 0"},"show-count":"","auto-size":""},null,8,["value","onUpdate:value"])):(L(),P("div",{key:1,innerHTML:(a=t.content,a.replace(/\n/g,"<br />"))},null,8,Dt))])):"operation"===e.dataIndex?(L(),P("div",Nt,[M($)[t.key]?(L(),P("div",Mt,[v(r,{class:"operation-btn",size:"small",loading:M(b),type:"link",onClick:e=>(async e=>{b.value=!0,Y.warn("正在更新……");try{await ye(await ne.updateDocCompleted({chunk_size:s.value.chunkSize,doc_id:e,update_content:$.value[e].editContent})),Y.success("修改成功"),$.value[e].content=$.value[e].editContent,Object.assign(x.value.filter((t=>e===t.key))[0],$.value[e]),delete $.value[e]}catch(t){Y.error(t.msg)}finally{b.value=!1}})(t.key)},{default:E((()=>[G(W(M(b)?"":M(l).save),1)])),_:2},1032,["loading","onClick"]),M(b)?N("",!0):(L(),U(r,{key:0,class:"operation-btn",size:"small",loading:M(b),type:"text",onClick:e=>{return a=t.key,void delete $.value[a];var a}},{default:E((()=>[G(W(M(l).cancel),1)])),_:2},1032,["loading","onClick"]))])):(L(),U(i,{key:1,onClick:e=>{return a=t.key,void($.value[a]=JSON.parse(JSON.stringify(x.value.filter((e=>a===e.key))[0])));var a}},{default:E((()=>[G(W(M(l).edit),1)])),_:2},1032,["onClick"]))])):N("",!0)];var a})),_:1},8,["columns","data-source","scroll","pagination","loading","row-selection"])],512)]),F("div",Et,[v(r,{type:"primary",onClick:I},{default:E((()=>[G(W(M(l).close),1)])),_:1})])])),_:1},8,["open"])])),_:1})])}}}),[["__scopeId","data-v-5b124323"]]),Wt={class:"file"},Rt={class:"box"},Ut={class:"before-upload-box"},qt=["accept"],Xt={class:"before-upload"},Bt={class:"upload-text-box"},Ht={class:"upload-text"},Vt={class:"blue"},Qt={class:"desc"},Kt=T(u({__name:"FileUploadDialog",props:{dialogType:{type:Number,require:!0,default:0}},setup(t){const a=ke().common,{setKnowledgeName:l,setModalVisible:s}=pe(),{setDefault:r}=ve(),{getDetails:o}=de(),{modalVisible:n,modalTitle:i}=A(pe()),{currentId:c,currentKbName:u}=A(ve()),{uploadFileList:d,uploadFileListQuick:m}=A(me()),{initUploadFileList:g}=me(),{chatSettingFormActive:f}=A(we()),y=t,k=e(),h=p((()=>c.value.length>0&&d.value.length>0&&d.value.every((e=>"loading"!=e.status))));D((()=>n.value),(()=>{l(u.value),1===y.dialogType&&(d.value=m.value),n.value||0!==y.dialogType||g()}));const b=[".md",".txt",".pdf",".jpg",".png",".jpeg",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".jsonl",".eml",".csv"],w={document:31457280,image:5242880},C=e=>{const t=e.target.files;let l=0;Array.from(t).forEach((e=>{l+=e.size,l>=131072e3&&Y.error("文件总大小超过125MB")})),Array.from(t).forEach((async(e,t)=>{try{await(async(e,t)=>new Promise(((l,s)=>{if(e.name&&b.includes("."+e.name.split(".").pop().toLowerCase())){const r=e.type.startsWith("image/")?w.image:w.document,o=e.type.startsWith("image/")?"图片":"文档";if(e.size>r)return void s(`单个${o}太大，不能超过 ${r/1024/1024} MB`);d.value.push({file_name:e.name,file:e,status:"loading",text:a.uploading,file_id:"",order:d.value.length,bytes:0}),l(t)}else s(`${e.name}的文件格式不符`)})))(e,t)}catch(l){Y.error(l)}})),setTimeout((()=>{d.value.length&&x()}))},x=async()=>{var e;S();const t=[];d.value.forEach((e=>{"loading"==e.status&&t.push(e)}));const l=new FormData;for(let a=0;a<t.length;a++)l.append("files",null==(e=t[a])?void 0:e.file);l.append("kb_id",c.value),l.append("user_id",ie),l.append("chunk_size",f.value.chunkSize.toString()),l.append("mode","soft"),$(0),fetch(ce+"/local_doc_qa/upload_files",{method:"POST",body:l,credentials:"include",headers:{Authorization:`Bearer ${le.get("token")}`}}).then((e=>{if(e.ok)return e.json();throw new Error("上传失败")})).then((e=>{if(200===e.code){if(0===e.data.length)return Y.warn(e.msg||"出错了"),se.close("upload"),void(1===y.dialogType&&t.forEach((t=>{d.value[t.order].status="error",d.value[t.order].errorText=(null==e?void 0:e.msg)||a.upFailed})));$(1),1===y.dialogType&&t.forEach(((t,l)=>{let s=e.data[l].status;s="green"==s||"gray"==s?"success":"error",d.value[t.order].status=s,d.value[t.order].file_id=e.data[l].file_id,d.value[t.order].bytes=e.data[l].bytes,d.value[t.order].errorText=a.upSucceeded}))}else Y.error(e.msg||"出错了"),se.close("upload"),t.forEach((t=>{d.value[t.order].status="error",d.value[t.order].errorText=(null==e?void 0:e.msg)||a.upFailed}))})).catch((e=>{Y.error(e.msg||"出错了"),se.close("upload")})).finally((()=>{o()}))},$=e=>{se[e?"success":"info"]({key:"upload",message:e?"上传完成":"上传中",description:e?"":"最多需要30s",duration:e?2.5:0})},_=async()=>{s(!1),r(ge.optionlist),await o()},S=()=>{s(!1)};return te((()=>{k.value&&clearTimeout(k.value)})),(e,t)=>{const l=Q,s=B;return L(),U(q,{to:"body"},[v(s,{open:M(n),"onUpdate:open":t[1]||(t[1]=e=>H(n)?n.value=e:null),title:M(i),centered:"",width:"480px","wrap-class-name":"upload-file-modal","destroy-on-close":""},{footer:E((()=>[0===y.dialogType?(L(),U(l,{key:"submit",type:"primary",class:"upload-btn",disabled:!M(h),onClick:_},{default:E((()=>[G(W(M(a).confirm),1)])),_:1},8,["disabled"])):N("",!0),1===y.dialogType?(L(),U(l,{key:"submit",type:"primary",class:"upload-btn",onClick:S},{default:E((()=>[G(W(M(a).cancel),1)])),_:1})):N("",!0)])),default:E((()=>[F("div",Wt,[F("div",Rt,[F("div",Ut,[F("input",{class:"hide input",type:"file",accept:b.join(","),multiple:"",onChange:C,onClick:t[0]||(t[0]=e=>e.target.value="")},null,40,qt),F("div",Xt,[F("div",Bt,[v(ae,{name:"upload"}),F("p",null,[F("span",Ht,[G(W(M(a).dragUrl)+" ",1),F("span",Vt,W(M(a).click),1)])])]),F("p",Qt,W(M(a).updesc1),1)])])])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-189b1120"]]),Gt=e=>(Z("data-v-2e7c989c"),e=e(),ee(),e),Jt={class:"list-page"},Yt={class:"content"},Zt={class:"options"},ea={class:"kb-name"},ta={class:"name"},aa={class:"id"},la={class:"nav-info"},sa={class:"navs"},ra={class:re(["nav-item","nav-item-active"])},oa={key:0,class:"nav-progress"},na={class:"handle-btn"},ia={class:"table"},ca={key:0,style:{display:"flex","align-items":"center"}},ua={style:{color:"#666","user-select":"text"}},da={key:2,class:"status-box"},pa={class:"icon-file-status"},va={key:0},ma={key:1},ga={key:0,class:"status-box"},fa={class:"icon-file-status"},ya={key:1,class:"options"},ka={class:"filter-container",style:{"margin-bottom":"16px"}},ha={class:"members-container"},ba={class:"members-column"},wa={class:"column-header"},Ca={class:"members-list"},xa=["onClick"],$a={class:"member-avatar"},_a={class:"member-name"},Sa={key:0,class:"member-action"},Ia=Gt((()=>F("span",{class:"action-text"},"添加",-1))),Oa={key:1,class:"member-status"},ja={class:"members-column"},za={class:"column-header"},Pa={class:"members-list"},La=["onClick"],Ta={class:"member-avatar"},Aa={class:"member-name"},Da={class:"member-action remove"},Na=Gt((()=>F("span",{class:"action-text"},"移除",-1))),Ma=T(u({__name:"OptionList",setup(t){const{setDefault:a}=ve(),{currentKbName:l,currentId:s}=A(ve()),{setModalVisible:r,setUrlModalVisible:o,setModalTitle:n}=pe(),{showChunkModel:i}=A(yt()),{getDetails:c,setEditQaSet:u,setEditModalVisible:d,getFaqList:g,setFaqType:f,setPageNum:y,setKbPageNum:k}=de(),{dataSource:h,faqList:b,timer:w,faqTimer:C,total:x,pageNum:$,pageSize:_,loading:S,kbTotal:I,kbPageNum:O,kbPageSize:z}=A(de()),T=ke().home,R=ke().common,q=ke().bots,V=p((()=>J.value)),J=p((()=>s.value.endsWith("_FAQ")?1:0)),Z=[{title:T.documentId,dataIndex:"fileId",key:"fileId",width:"8%"},{title:T.documentName,dataIndex:"fileIdName",key:"fileIdName",width:"12%",ellipsis:!0},{title:T.documentTag,dataIndex:"fileTag",key:"fileTag",width:"12%"},{title:T.documentStatus,dataIndex:"status",key:"status",width:"10%",ellipsis:!0},{title:T.fileSize,dataIndex:"bytes",key:"bytes",width:"8%"},{title:T.contentLength,dataIndex:"contentLength",key:"contentLength",width:"10%"},{title:T.creationDate,dataIndex:"createtime",key:"createtime",width:"10%"},{title:T.remark,dataIndex:"remark",key:"remark",width:"15%"},{title:T.operate,key:"options",width:"10%"}],ee=[{title:"ID",dataIndex:"id",key:"id",width:"8%"},{title:T.question,dataIndex:"question",key:"question",width:"43%",ellipsis:!0},{title:T.status,dataIndex:"status",key:"status",width:"10%",ellipsis:!0},{title:T.characterCount,dataIndex:"bytes",key:"bytes",width:"10%"},{title:T.creationDate,dataIndex:"createtime",key:"createtime",width:"11%"},{title:T.operate,key:"options",width:"10%"}],le=p((()=>({current:O.value,pageSize:z.value,total:I.value,showSizeChanger:!1,showTotal:e=>`共 ${e} 条`}))),se=p((()=>({current:$.value,pageSize:_.value,total:x.value,showSizeChanger:!1,showTotal:e=>`共 ${e} 条`})));let ie={};const ce=e(""),ue=e(""),me=async()=>{try{await ye(await ne.deleteFile({file_ids:[ie.fileId],kb_id:s.value})),Y.success("删除成功"),await c(),1!==O.value&&0===h.value.length&&(O.value-=1,await c())}catch(e){Y.error(e.msg||"删除失败")}};let fe={};const he=async()=>{try{await ye(await ne.deleteFile({kb_id:`${s.value}_FAQ`,file_ids:[fe.faqId]})),Y.success("删除成功"),await g(),1!==$.value&&0===b.value.length&&($.value-=1,await g())}catch(e){Y.error(e.msg||"删除失败")}},we=()=>{a(ge.normal)},Ce=()=>{r(!0),n(T.upload)},xe=()=>{o(!0),n(R.addUrl)},$e=()=>{f("upload"),d(!0)},Oe=()=>{B.confirm({title:T.clearAllFile,content:K("p",T.clearAllFileConfirm),centered:!0,maskClosable:!0,okText:R.confirm,okType:"danger",async onOk(){try{await ye(await ne.clearUpload({status:"gray",kb_ids:[]})),Y.success("操作成功"),c()}catch(e){Y.error(e.msg||"操作失败")}}})},Ee=e=>{let t;switch(e){case"gray":t=R.inLine;break;case"yellow":t=R.parsing;break;case"green":t=R.succeeded;break;default:t=R.failed}return t},Fe=e=>{let t=R.failed;switch(e){case"gray":t=R.uploadCompleted;break;case"yellow":t=R.inLine;break;case"green":t=R.learningCompleted}return t},We=e=>{const{current:t}=e;y(t),g()},Re=e=>{k(e.current),c()},Ue=e(new Map),qe=e=>{const t=e.fileId,a=e.fileIdName;Ue.value.has(t)?Ue.value.delete(t):Ue.value.set(t,a)},Xe=(...e)=>{e[2].map((e=>{const t=e.key,a=e.fileIdName;Ue.value.has(t)?Ue.value.delete(t):Ue.value.set(t,a)}))};D(s,(()=>{k(1),y(1),c()}),{immediate:!0}),te((()=>{clearTimeout(w.value),clearTimeout(C.value),k(1),y(1)}));const Be=e(!1);e("");const He=e(!1),Ve=e([]),Qe=e("user"),Ke=p((()=>{switch(Qe.value){case"user":default:return"成员";case"department":return"部门";case"group":return"用户组"}})),Ge=e=>{Qe.value=e,Je()},Je=async()=>{He.value=!0;try{let e;switch(Qe.value){case"user":e=await ne.userList(),200===e.code&&(Ve.value=e.data.map((e=>({id:e.user_id,name:e.user_name,permissions:e.permissions,role:e.role}))));break;case"department":e=await ne.departmentList(),200===e.code&&(Ve.value=e.data.map((e=>({id:e.dept_id,name:e.dept_name,permissions:e.permissions||[]}))));break;case"group":e=await ne.groupList(),200===e.code&&(Ve.value=e.data.map((e=>({id:e.group_id,name:e.group_name,permissions:e.permissions||[]}))))}200!==e.code&&Y.error(e.msg||`获取${Ke.value}列表失败`)}catch(e){Y.error(`获取${Ke.value}列表失败`)}finally{He.value=!1}},Ye=(e,t)=>{if(!e)return!1;if("department"===Qe.value||"group"===Qe.value)return Array.isArray(e.permissions)&&e.permissions.some((e=>e.kb_id===t));if(e.permissions){return[e.permissions.direct_access&&e.permissions.direct_access.some((e=>e.kb_id===t)),e.permissions.owned_kbs&&e.permissions.owned_kbs.some((e=>e.kb_id===t)),e.permissions.department_access&&Array.isArray(e.permissions.department_access)&&e.permissions.department_access.some((e=>e.kb_id===t)),e.permissions.group_access&&Array.isArray(e.permissions.group_access)&&e.permissions.group_access.some((e=>e.kb_id===t))].some((e=>!0===e))}return!1},Ze=p((()=>{let e=Ve.value;return"user"===Qe.value&&(e=e.filter((e=>"superadmin"!==e.role))),e.filter((e=>{const t=Ye(e,s.value);return e.disabled=t,!t}))})),et=p((()=>{let e=Ve.value;return"user"===Qe.value&&(e=e.filter((e=>"superadmin"!==e.role))),e.filter((e=>Ye(e,s.value)))})),tt=()=>{Be.value=!0,Je()},at=()=>{Be.value=!1},lt=()=>{Be.value=!1};return j((()=>{0===J.value?(c(),clearInterval(w.value),w.value=setInterval((()=>{c()}),5e3)):(g(),clearInterval(C.value),C.value=setInterval((()=>{g()}),5e3)),Je()})),(e,t)=>{const a=Q,r=be,o=ae,n=Se,c=_e,p=Ae,g=Te,y=Ie,k=De,w=B,C=X;return L(),U(C,{theme:{token:{colorPrimary:"#5a47e5"}}},{default:E((()=>[F("div",Jt,[F("div",Yt,[F("div",Zt,[v(a,{type:"primary",class:"to-chat",onClick:we},{default:E((()=>[v(M(je),{class:"back-icon"}),F("span",null,W(M(T).conversation),1)])),_:1}),F("p",ea,[F("span",ta,W(M(l).slice(0,15)),1),F("span",aa,W(M(T).knowledgeID)+" "+W(M(s)),1)])]),F("div",la,[F("div",sa,[F("div",ra,W(0===M(V)?M(T).docSet:M(T).qaSet),1)]),0===M(V)?(L(),P("div",oa,[v(_t,{"data-source":M(h)},null,8,["data-source"])])):N("",!0),F("div",na,[0===M(V)?(L(),U(a,{key:0,danger:"",class:"clear-upload",onClick:Oe},{default:E((()=>[G(W(M(T).clearAllFile),1)])),_:1})):N("",!0),0===M(V)?(L(),U(a,{key:1,class:"upload",onClick:Ce},{default:E((()=>[G(W(M(T).upload),1)])),_:1})):N("",!0),0===M(V)?(L(),U(a,{key:2,class:"add-link",onClick:xe},{default:E((()=>[G(W(M(T).addUrl),1)])),_:1})):N("",!0),0===M(V)?(L(),U(a,{key:3,class:"manage-members",onClick:tt},{default:E((()=>[v(M(ze)),G(" 管理成员 ")])),_:1})):N("",!0),1===M(V)?(L(),U(a,{key:4,class:"upload",onClick:$e},{default:E((()=>[G(W(M(T).inputQa),1)])),_:1})):N("",!0)])]),F("div",ia,[0===M(V)?(L(),U(c,{key:0,"data-source":M(h),columns:Z,pagination:M(le),locale:{emptyText:M(T).emptyText},"hide-on-single-page":!0,"show-size-changer":!1,"row-selection":{selectedRowKeys:[...M(Ue).keys()],onSelect:qe,onSelectAll:Xe},onChange:Re},{headerCell:E((({column:e})=>["status"===e.key?(L(),P("span",ca,[G(W(M(T).documentStatus)+" ",1),v(r,{color:"#5a47e5"},{title:E((()=>[G(W(M(T).documentStatusNode),1)])),default:E((()=>[v(M(Le),{style:{"margin-left":"5px","font-size":"16px",color:"#999"}})])),_:1})])):N("",!0)])),bodyCell:E((({column:e,record:t})=>["fileIdName"===e.key?(L(),U(r,{key:0,color:"#fff",placement:"topLeft"},{title:E((()=>[F("span",ua,W(t.fileIdName),1)])),default:E((()=>[F("span",null,W(t.fileIdName),1)])),_:2},1024)):"fileTag"===e.key?(L(),P(m,{key:1},[],64)):"status"===e.key?(L(),P("div",da,[F("span",pa,["gray"===t.status||"yellow"===t.status?(L(),U(kt,{key:0,class:"file-status"})):(L(),U(o,{key:1,class:"file-status",name:"green"===t.status?"success":"error"},null,8,["name"]))]),F("span",null,W(Ee(t.status)),1)])):"remark"===e.key?(L(),P(m,{key:3},["string"==typeof t.remark?(L(),P("div",va,W(t.remark),1)):(L(),P("div",ma,[(L(!0),P(m,null,oe(t.remark,((e,t)=>(L(),P("p",{key:t},W(`${t}: ${e}`),1)))),128))]))],64)):"options"===e.key?(L(),P(m,{key:4},[v(n,{"overlay-class-name":"del-pop",placement:"topRight",title:M(R).deleteTitle,"ok-text":M(R).confirm,"cancel-text":M(R).cancel,onConfirm:me},{default:E((()=>[v(a,{type:"text",class:"delete-item",onClick:e=>{ie=t}},{default:E((()=>[G(W(M(R).delete),1)])),_:2},1032,["onClick"])])),_:2},1032,["title","ok-text","cancel-text"]),v(a,{type:"text",class:"view-item",disabled:!("green"===t.status),onClick:e=>(async e=>{ce.value=e.fileId,ue.value=e.fileIdName,i.value=!0})(t)},{default:E((()=>[G(W(M(R).view),1)])),_:2},1032,["disabled","onClick"])],64)):N("",!0)])),_:1},8,["data-source","pagination","locale","row-selection"])):(L(),U(c,{key:1,"data-source":M(b),columns:ee,locale:{emptyText:M(T).emptyText},loading:M(S),pagination:M(se),onChange:We},{bodyCell:E((({column:e,record:t})=>["status"===e.key?(L(),P("div",ga,[F("span",fa,["gray"===t.status||"yellow"===t.status?(L(),U(kt,{key:0,class:"file-status"})):(L(),U(o,{key:1,class:"file-status",name:"green"===t.status?"success":"error"},null,8,["name"]))]),F("span",null,W(Fe(t.status)),1)])):"options"===e.key?(L(),P("div",ya,[v(a,{class:"edit-item",type:"link",disabled:"green"!==t.status,onClick:e=>{return a=t,f("edit"),u(a),void d(!0);var a}},{default:E((()=>[G(W(M(q).edit),1)])),_:2},1032,["disabled","onClick"]),v(n,{"overlay-class-name":"qa-del-pop",placement:"topRight",title:M(T).deleteQaSetText,"ok-text":M(R).confirm,"cancel-text":M(R).cancel,onConfirm:he},{default:E((()=>[v(a,{class:"delete-item",danger:"",type:"link",onClick:e=>{fe=t}},{default:E((()=>[G(W(M(R).delete),1)])),_:2},1032,["onClick"])])),_:2},1032,["title","ok-text","cancel-text"])])):N("",!0)])),_:1},8,["data-source","locale","loading","pagination"]))])])]),v(Ft,{"kb-id":M(s),"file-id":M(ce),"file-name":M(ue)},null,8,["kb-id","file-id","file-name"]),v(Kt,{"dialog-type":0}),v(w,{visible:M(Be),"onUpdate:visible":t[1]||(t[1]=e=>H(Be)?Be.value=e:null),title:"管理知识库成员权限",width:"800px",onOk:at,onCancel:lt,footer:null},{default:E((()=>[F("div",ka,[v(g,{value:M(Qe),"onUpdate:value":t[0]||(t[0]=e=>H(Qe)?Qe.value=e:null),style:{width:"120px"},onChange:Ge},{default:E((()=>[v(p,{value:"user"},{default:E((()=>[G("用户")])),_:1}),v(p,{value:"department"},{default:E((()=>[G("部门")])),_:1}),v(p,{value:"group"},{default:E((()=>[G("用户组")])),_:1})])),_:1},8,["value"])]),F("div",ha,[F("div",ba,[F("div",wa,"可添加"+W(M(Ke)),1),v(k,{spinning:M(He)},{default:E((()=>[F("div",Ca,[(L(!0),P(m,null,oe(M(Ze),(e=>(L(),P("div",{key:e.id,class:re(["member-item",{disabled:e.disabled}]),onClick:t=>!e.disabled&&(async e=>{const t=Ve.value.find((t=>t.id===e));if(t)try{const a=await ne.grantKbAccess({kb_id:s.value,user_id:localStorage.getItem("userId"),subject_type:Qe.value,subject_id:e,permission_type:"read"});200===a.code?(Y.success(`已添加${Ke.value}: ${t.name}`),await Je()):Y.error(a.msg||`添加${Ke.value}失败`)}catch(a){Y.error(`添加${Ke.value}失败`)}})(e.id)},[F("div",$a,["user"===M(Qe)?(L(),U(M(Ne),{key:0})):"department"===M(Qe)?(L(),U(M(ze),{key:1})):"group"===M(Qe)?(L(),U(M(ft),{key:2})):N("",!0)]),F("div",_a,W(e.name),1),e.disabled?N("",!0):(L(),P("div",Sa,[v(M(Me)),Ia])),e.disabled?(L(),P("div",Oa,[v(y,{color:"default"},{default:E((()=>[G("已有权限")])),_:1})])):N("",!0)],10,xa)))),128))])])),_:1},8,["spinning"])]),F("div",ja,[F("div",za,"知识库"+W(M(Ke)),1),v(k,{spinning:M(He)},{default:E((()=>[F("div",Pa,[(L(!0),P(m,null,oe(M(et),(e=>(L(),P("div",{key:e.id,class:"member-item",onClick:t=>(async e=>{const t=Ve.value.find((t=>t.id===e));if(t)try{const a=await ne.revokeKbAccess({kb_id:s.value,user_id:localStorage.getItem("userId"),subject_type:Qe.value,subject_id:e});200===a.code?(Y.success(`已移除${Ke.value}: ${t.name}`),await Je()):Y.error(a.msg||`移除${Ke.value}失败`)}catch(a){Y.error(`移除${Ke.value}失败`)}})(e.id)},[F("div",Ta,["user"===M(Qe)?(L(),U(M(Ne),{key:0})):"department"===M(Qe)?(L(),U(M(ze),{key:1})):"group"===M(Qe)?(L(),U(M(ft),{key:2})):N("",!0)]),F("div",Aa,W(e.name),1),F("div",Da,[v(M(Pe)),Na])],8,La)))),128))])])),_:1},8,["spinning"])])])])),_:1},8,["visible"])])),_:1})}}}),[["__scopeId","data-v-2e7c989c"]]);export{Kt as F,kt as L,Ma as O,st as _};
