import{d as e,a0 as t,v as n,as as l,a,V as o,e as s,b as i,Q as u,R as c,n as r,o as v,$ as p,O as d,l as f,E as g,C as m,c as x,a8 as w,U as y,Y as C,M as h}from"./index-Dnd1wrVz.js";import{g as k}from"./index-BGs17W_C.js";const b=["onClick"],R={class:"mention-item-text"},_=f(e({__name:"Mention",props:{activeIndex:{},options:{},position:{}},emits:["selectMention","update:activeIndex"],setup(e,{expose:f,emit:g}){const m=e,x=g,{activeIndex:w,options:y,position:C}=t(m),h=e=>{x("selectMention",e)},k=e=>{let t=w.value;"down"===e?(t++,t>=y.value.length-1&&(t=0)):"up"===e&&(t--,t<0&&(t=y.value.length-1)),x("update:activeIndex",t),I()},_=n(null),I=()=>{r((()=>{const e=_.value,t=e.children[w.value];if(e&&t){const n=e.clientHeight,l=t.clientHeight,a=t.offsetTop,o=e.scrollTop;a<o?e.scrollTop=a:a+l>o+n&&(e.scrollTop=a+l-n)}}))};return f({initScroll:()=>{r((()=>{const e=_.value;e&&(e.scrollTop=0)}))}}),window.addEventListener("keydown",(e=>{-9999!==C.value.top&&("ArrowDown"===e.key?k("down"):"ArrowUp"===e.key?k("up"):"Enter"===e.key&&h(y.value[w.value].value))})),l((()=>{})),(e,t)=>(v(),a("div",{class:"mention-container",style:o({top:s(C).top+"px",left:s(C).left+"px"})},[i("ul",{ref_key:"mentionList",ref:_,class:"mention-list"},[(v(!0),a(u,null,c(s(y),((e,t)=>(v(),a("li",{key:e.value,class:p(["mention-item",t===s(w)?"mention-item-active":""]),onClick:t=>h(e.value)},[i("span",R,d(e.label),1)],10,b)))),128))],512)],4))}}),[["__scopeId","data-v-5fbe98ce"]]),I={class:"chat-textarea-container"},S={class:"chat-textarea-wrapper"},V={key:0},A={class:"send-action"},E=f(e({__name:"ChatTextarea",props:{inputValue:{},options:{}},emits:["update:inputValue","send"],setup(e,{emit:o}){const c=n(null),p=k().common,f=e,{inputValue:b,options:R}=t(f),E=o,T=n(0),K=e=>{E("update:inputValue",e.target.textContent),r((()=>{P.value=0,U.value.initScroll(),T.value=O();const e=T.value,t=b.value,n=t.lastIndexOf("@",e-1);if(-1!==n){const l=t.substring(n+1,e),a=j.value.filter((e=>e.label.includes(l)));if(0!==a.length){j.value=a;const{left:e,top:t}=L();H.value.left=e+5,H.value.top=t+20}else Y()}else Y()}))};g((()=>{r((()=>{var e;null==(e=c.value)||e.focus()}))}));const M=e=>{var t;e.stopPropagation(),null==(t=c.value)||t.focus()},O=()=>{var e;const t=window.getSelection().getRangeAt(0),n=t.cloneRange(),l=null==(e=c.value)?void 0:e.firstChild;return l?(n.selectNodeContents(l),n.setEnd(t.endContainer,t.endOffset),n.toString().length):0},D=e=>{var t;if(c.value){const l=null==(t=c.value)?void 0:t.firstChild,a=window.getSelection(),o=document.createRange();if(!l)return;try{o.setStart(l,e),o.setEnd(l,e),o.collapse(!0),a.removeAllRanges(),a.addRange(o)}catch(n){o.setStart(l,T.value),o.setEnd(l,T.value),o.collapse(!0),a.removeAllRanges(),a.addRange(o)}}},L=()=>{if(!c.value)return;const e=window.getSelection();if(!e||0===e.rangeCount)return;const t=e.getRangeAt(0).getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}},U=n(null),j=n([]),H=n({left:0,top:-9999}),P=n(0),Y=()=>{H.value.top=-9999,j.value=[...R.value.map((e=>({label:e,value:e})))],P.value=0},$=e=>{Y();const t=T.value,n=b.value,l=n.lastIndexOf("@",t-1),a=n.substring(0,l+1)+e+" "+n.substring(t);E("update:inputValue",a),c.value.textContent=a,D(t+e.length+1)};window.addEventListener("click",(()=>{-9999!==H.value.top&&Y()})),l((()=>{j.value=[...R.value.map((e=>({label:e,value:e})))]}));const B=()=>{E("send"),r((()=>{var e;null==(e=c.value)||e.focus()}))};return m((()=>f.inputValue),(()=>{0===f.inputValue.length&&(c.value.textContent=f.inputValue)})),(e,t)=>(v(),a(u,null,[i("div",I,[i("div",S,[i("div",{ref_key:"textareaRef",ref:c,class:"chat-textarea",contenteditable:"plaintext-only",onInput:K,onKeydown:t[0]||(t[0]=e=>{var t;13===(t=e).keyCode?t.altKey||t.ctrlKey||t.shiftKey||t.metaKey?r((()=>{T.value=O();const e=b.value.replaceAll(/<br>/g,"\n");c.value.textContent=e,D(T.value)})):(t.preventDefault(),-9999===H.value.top&&B()):37===t.keyCode||39===t.keyCode?K(t):38!==t.keyCode&&40!==t.keyCode||-9999!==H.value.top&&t.preventDefault()})},null,544),i("div",{class:"placeholder",onClick:w(M,["prevent"])},[s(b).length?y("",!0):(v(),a("span",V,d(s(p).problemPlaceholder),1))])]),i("div",A,[C(e.$slots,"default",{},void 0,!0)])]),x(_,{ref_key:"mentionRef",ref:U,"active-index":s(P),"onUpdate:activeIndex":t[1]||(t[1]=e=>h(P)?P.value=e:null),options:s(j),position:s(H),onSelectMention:$},null,8,["active-index","options","position"])],64))}}),[["__scopeId","data-v-8c510fd3"]]);export{E as C};
